name: Encode Private Script

on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'  # Every 30 minutes

jobs:
  encode:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Fetch and encode script
        env:
          GH_TOKEN: ${{ secrets.PRIVATE_REPO_TOKEN }}
        run: |
          # Fetch from private repo
          SCRIPT=$(curl -H "Authorization: token $GH_TOKEN" \
            -H "Accept: application/vnd.github.v3.raw" \
            "https://api.github.com/repos/DJB5001/The-Forge-Test/contents/loader.lua?ref=main")
          
          # Encode to base64
          echo "$SCRIPT" | base64 -w 0 > encoded.txt
          
      - name: Commit encoded file
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add encoded.txt
          git diff --quiet && git diff --staged --quiet || git commit -m "Update encoded script"
          git push