-- dj_tab_ingame.lua
-- Ingame features tab for DJ HUB (without mining)

return function(Window, Rayfield, Utils)
   local IngameTab = Window:CreateTab("🎮 Ingame", nil)
   
   IngameTab:CreateSection("Player Features")
   
   -- Jump Power
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")
   local savedJumpPower = 50
   
   local function setJumpPower(power)
      local character = LocalPlayer.Character
      if not character then return false end
      
      local humanoid = character:FindFirstChildOfClass("Humanoid")
      if humanoid then
         humanoid.JumpPower = power
         savedJumpPower = power
         return true
      end
      return false
   end
   
   -- Restore on respawn
   LocalPlayer.CharacterAdded:Connect(function(character)
      local humanoid = character:WaitForChild("Humanoid", 5)
      if humanoid then
         task.wait(0.1)
         humanoid.JumpPower = savedJumpPower
      end
   end)
   
   IngameTab:CreateSlider({
      Name = "Jump Power",
      Range = {50, 500},
      Increment = 10,
      Suffix = "Power",
      CurrentValue = 50,
      Flag = "IngameJumpPower",
      Callback = function(Value)
         if not setJumpPower(Value) then
            Rayfield:Notify({
               Title = "Error",
               Content = "Character not found!",
               Duration = 3
            })
         end
      end,
   })
   
   -- Fly Speed
   local flyEnabled = false
   local flySpeed = 50
   local flyConnection = nil
   
   IngameTab:CreateSlider({
      Name = "Fly Speed",
      Range = {10, 200},
      Increment = 10,
      Suffix = "Speed",
      CurrentValue = 50,
      Flag = "IngameFlySpeed",
      Callback = function(Value)
         flySpeed = Value
      end,
   })
   
   IngameTab:CreateToggle({
      Name = "Fly",
      CurrentValue = false,
      Flag = "IngameFly",
      Callback = function(enabled)
         flyEnabled = enabled
         
         if enabled then
            local character = LocalPlayer.Character
            local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")
            
            if not humanoidRootPart then
               Rayfield:Notify({
                  Title = "Fly",
                  Content = "❌ Character not found!",
                  Duration = 3
               })
               return
            end
            
            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
            bodyVelocity.Parent = humanoidRootPart
            
            local bodyGyro = Instance.new("BodyGyro")
            bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
            bodyGyro.P = 9e4
            bodyGyro.Parent = humanoidRootPart
            
            flyConnection = RunService.Heartbeat:Connect(function()
               if not flyEnabled then return end
               
               local camera = workspace.CurrentCamera
               local moveDirection = Vector3.new(0, 0, 0)
               
               local UserInputService = game:GetService("UserInputService")
               
               if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                  moveDirection = moveDirection + camera.CFrame.LookVector
               end
               if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                  moveDirection = moveDirection - camera.CFrame.LookVector
               end
               if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                  moveDirection = moveDirection - camera.CFrame.RightVector
               end
               if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                  moveDirection = moveDirection + camera.CFrame.RightVector
               end
               if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                  moveDirection = moveDirection + Vector3.new(0, 1, 0)
               end
               if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                  moveDirection = moveDirection - Vector3.new(0, 1, 0)
               end
               
               bodyVelocity.Velocity = moveDirection * flySpeed
               bodyGyro.CFrame = camera.CFrame
            end)
            
            Rayfield:Notify({
               Title = "Fly",
               Content = "✅ Enabled! Use WASD + Space/Shift",
               Duration = 4
            })
         else
            if flyConnection then
               flyConnection:Disconnect()
               flyConnection = nil
            end
            
            local character = LocalPlayer.Character
            local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")
            
            if humanoidRootPart then
               for _, obj in pairs(humanoidRootPart:GetChildren()) do
                  if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                     obj:Destroy()
                  end
               end
            end
            
            Rayfield:Notify({
               Title = "Fly",
               Content = "❌ Disabled",
               Duration = 3
            })
         end
      end,
   })
   
   IngameTab:CreateSection("Visual")
   
   -- ESP for players (simple)
   local espEnabled = false
   local espConnections = {}
   
   IngameTab:CreateToggle({
      Name = "Player ESP",
      CurrentValue = false,
      Flag = "IngamePlayerESP",
      Callback = function(enabled)
         espEnabled = enabled
         
         if enabled then
            for _, player in pairs(Players:GetPlayers()) do
               if player ~= LocalPlayer then
                  local function addESP(character)
                     local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
                     if not humanoidRootPart then return end
                     
                     local highlight = Instance.new("Highlight")
                     highlight.Adornee = character
                     highlight.FillColor = Color3.fromRGB(255, 0, 0)
                     highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                     highlight.FillTransparency = 0.5
                     highlight.OutlineTransparency = 0
                     highlight.Parent = character
                     highlight.Name = "DJHUB_ESP"
                  end
                  
                  if player.Character then
                     addESP(player.Character)
                  end
                  
                  table.insert(espConnections, player.CharacterAdded:Connect(function(character)
                     if espEnabled then
                        addESP(character)
                     end
                  end))
               end
            end
            
            table.insert(espConnections, Players.PlayerAdded:Connect(function(player)
               if espEnabled and player ~= LocalPlayer then
                  player.CharacterAdded:Connect(function(character)
                     if espEnabled then
                        local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
                        if not humanoidRootPart then return end
                        
                        local highlight = Instance.new("Highlight")
                        highlight.Adornee = character
                        highlight.FillColor = Color3.fromRGB(255, 0, 0)
                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 0
                        highlight.Parent = character
                        highlight.Name = "DJHUB_ESP"
                     end
                  end)
               end
            end))
            
            Rayfield:Notify({
               Title = "ESP",
               Content = "✅ Player ESP enabled",
               Duration = 3
            })
         else
            for _, connection in pairs(espConnections) do
               connection:Disconnect()
            end
            espConnections = {}
            
            for _, player in pairs(Players:GetPlayers()) do
               if player.Character then
                  for _, obj in pairs(player.Character:GetDescendants()) do
                     if obj.Name == "DJHUB_ESP" and obj:IsA("Highlight") then
                        obj:Destroy()
                     end
                  end
               end
            end
            
            Rayfield:Notify({
               Title = "ESP",
               Content = "❌ Player ESP disabled",
               Duration = 3
            })
         end
      end,
   })
   
   IngameTab:CreateSection("Utility")
   
   -- Noclip
   local noclipEnabled = false
   local noclipConnection = nil
   
   IngameTab:CreateToggle({
      Name = "Noclip",
      CurrentValue = false,
      Flag = "IngameNoclip",
      Callback = function(enabled)
         noclipEnabled = enabled
         
         if enabled then
            noclipConnection = RunService.Stepped:Connect(function()
               if not noclipEnabled then return end
               
               local character = LocalPlayer.Character
               if character then
                  for _, part in pairs(character:GetDescendants()) do
                     if part:IsA("BasePart") then
                        part.CanCollide = false
                     end
                  end
               end
            end)
            
            Rayfield:Notify({
               Title = "Noclip",
               Content = "✅ Enabled - Walk through walls",
               Duration = 3
            })
         else
            if noclipConnection then
               noclipConnection:Disconnect()
               noclipConnection = nil
            end
            
            local character = LocalPlayer.Character
            if character then
               for _, part in pairs(character:GetDescendants()) do
                  if part:IsA("BasePart") then
                     part.CanCollide = true
                  end
               end
            end
            
            Rayfield:Notify({
               Title = "Noclip",
               Content = "❌ Disabled",
               Duration = 3
            })
         end
      end,
   })
end