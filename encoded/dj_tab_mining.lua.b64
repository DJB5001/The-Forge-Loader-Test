-- dj_tab_mining.lua
-- Auto Mining + Smart Index Farm (Fixed Pickaxe Detection)

return function(Window, Rayfield, Utils)
   local MiningTab = Window:CreateTab("⛏️ Mining", nil)
   
   MiningTab:CreateSection("Configuration")
   
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")
   local ReplicatedStorage = game:GetService("ReplicatedStorage")
   
   local miningEnabled = false
   local indexFarmEnabled = false
   local selectedRockTypes = {"Boulder"}
   local selectedLocation = "Island1CaveDeep"
   local selectedIndexAreas = {"All Areas"}
   local miningConnection = nil
   local indexFarmConnection = nil
   local noclipConnection = nil
   local flyConnection = nil
   local currentTargetRock = nil
   local isMovingToRock = false
   local flySpeed = 60
   local bodyVelocity = nil
   local bodyGyro = nil
   local characterAddedConnection = nil
   local rockStartTime = 0
   local ROCK_TIMEOUT = 360
   local currentRockTypeIndex = 1
   local lastIndexCheck = 0
   local INDEX_CHECK_INTERVAL = 5
   local cachedUnlockedItems = {}
   local cachedLockedItems = {}
   local availableIndexAreas = {"All Areas"}
   local totalDamageDone = 0
   local currentTargetOre = nil
   local currentPickaxePower = 4
   local currentPickaxeName = "Unknown"
   
   -- PICKAXE DATA
   local PickaxeData = {
      ["Stone Pickaxe"] = {MinePower = 4, Ore = "Stone"},
      ["Bronze Pickaxe"] = {MinePower = 7, Ore = "Copper"},
      ["Iron Pickaxe"] = {MinePower = 10, Ore = "Iron"},
      ["Gold Pickaxe"] = {MinePower = 16, Ore = "Gold"},
      ["Stonewake's Pickaxe"] = {MinePower = 33, Ore = "Stone"},
      ["Platinum Pickaxe"] = {MinePower = 24, Ore = "Platinum"},
      ["Arcane Pickaxe"] = {MinePower = 115, Ore = "Starite"},
      ["Cobalt Pickaxe"] = {MinePower = 40, Ore = "Cobalt"},
      ["Titanium Pickaxe"] = {MinePower = 55, Ore = "Titanium"},
      ["Uranium Pickaxe"] = {MinePower = 67, Ore = "Uranium"},
      ["Mythril Pickaxe"] = {MinePower = 80, Ore = "Mythril"},
      ["Lightite Pickaxe"] = {MinePower = 100, Ore = "Lightite"},
      ["Magma Pickaxe"] = {MinePower = 135, Ore = "Magmaite"},
      ["Demonic Pickaxe"] = {MinePower = 180, Ore = "Demonite"}
   }
   
   -- ROCK DATA
   local RockData = {
      Pebble = {
         Ores = {"Stone", "Sand Stone", "Copper", "Iron", "Poopite"},
         Health = 14,
         RequiredDamage = 4,
         LuckBoost = 0
      },
      Rock = {
         Ores = {"Sand Stone", "Copper", "Iron", "Tin", "Silver", "Poopite", "Bananite", "Cardboardite", "Mushroomite"},
         Health = 45,
         RequiredDamage = 7,
         LuckBoost = 0.5
      },
      Boulder = {
         Ores = {"Copper", "Iron", "Tin", "Silver", "Gold", "Platinum", "Poopite", "Bananite", "Cardboardite", "Mushroomite", "Aite"},
         Health = 100,
         RequiredDamage = 13,
         LuckBoost = 1
      },
      ["Lucky Block"] = {
         Ores = {"Fichillium", "Fichilliugeromoriteite"},
         Health = 10000,
         RequiredDamage = 1,
         LuckBoost = 100
      },
      ["Basalt Rock"] = {
         Ores = {"Silver", "Gold", "Platinum", "Cobalt", "Titanium", "Lapis Lazuli", "Eye Ore"},
         Health = 250,
         RequiredDamage = 16,
         LuckBoost = 5
      },
      ["Basalt Core"] = {
         Ores = {"Cobalt", "Titanium", "Lapis Lazuli", "Quartz", "Amethyst", "Topaz", "Diamond", "Sapphire", "Cuprite", "Emerald", "Eye Ore"},
         Health = 750,
         RequiredDamage = 39,
         LuckBoost = 7
      },
      ["Basalt Vein"] = {
         Ores = {"Quartz", "Amethyst", "Topaz", "Diamond", "Sapphire", "Cuprite", "Emerald", "Ruby", "Rivalite", "Uranium", "Mythril", "Eye Ore", "Lightite"},
         Health = 2750,
         RequiredDamage = 78,
         LuckBoost = 8
      },
      ["Volcanic Rock"] = {
         Ores = {"Volcanic Rock", "Topaz", "Cuprite", "Rivalite", "Obsidian", "Eye Ore", "Fireite", "Magmaite", "Demonite", "Darkryte"},
         Health = 4500,
         RequiredDamage = 100,
         LuckBoost = 8
      },
      ["Earth Crystal"] = {
         Ores = {"Blue Crystal", "Crimson Crystal", "Green Crystal", "Magenta Crystal", "Orange Crystal", "Rainbow Crystal", "Arcane Crystal"},
         Health = 5005,
         RequiredDamage = 78,
         LuckBoost = 10
      },
      ["Cyan Crystal"] = {
         Ores = {"Blue Crystal", "Crimson Crystal", "Green Crystal", "Magenta Crystal", "Orange Crystal", "Rainbow Crystal", "Arcane Crystal"},
         Health = 5005,
         RequiredDamage = 78,
         LuckBoost = 5
      },
      ["Crimson Crystal"] = {
         Ores = {"Blue Crystal", "Crimson Crystal", "Green Crystal", "Magenta Crystal", "Orange Crystal", "Rainbow Crystal", "Arcane Crystal"},
         Health = 5005,
         RequiredDamage = 78,
         LuckBoost = 5
      },
      ["Violet Crystal"] = {
         Ores = {"Blue Crystal", "Crimson Crystal", "Green Crystal", "Magenta Crystal", "Orange Crystal", "Rainbow Crystal", "Arcane Crystal"},
         Health = 5335,
         RequiredDamage = 78,
         LuckBoost = 5
      },
      ["Light Crystal"] = {
         Ores = {"Blue Crystal", "Crimson Crystal", "Green Crystal", "Magenta Crystal", "Orange Crystal", "Rainbow Crystal", "Arcane Crystal"},
         Health = 5005,
         RequiredDamage = 78,
         LuckBoost = 5
      }
   }
   
   local rockLocations = {
      "All",
      "Island1CaveDeep",
      "Island1CaveMid",
      "Island1CaveStart",
      "Roof",
      "Island2CaveDanger1",
      "Island2CaveDanger2",
      "Island2CaveDanger3",
      "Island2CaveDanger4",
      "Island2CaveDangerClosed",
      "Island2CaveDeep",
      "Island2CaveLavaClosed",
      "Island2CaveMid",
      "Island2CaveStart",
      "Island2GoblinCave",
      "Island2VolcanicDepths"
   }
   
   local rockTypes = {
      "Rock",
      "Boulder",
      "Pebble",
      "Lucky Block",
      "Light Crystal",
      "Volcanic Rock",
      "Basalt Core",
      "Basalt Rock",
      "Basalt Vein",
      "Violet Crystal",
      "Earth Crystal",
      "Cyan Crystal",
      "Crimson Crystal"
   }
   
   print("[MINING] Loading Smart Index Farm with Pickaxe Detection...")
   
   -- FIXED PICKAXE DETECTION
   local function detectPlayerPickaxe()
      local success = pcall(function()
         local playerGui = LocalPlayer:WaitForChild("PlayerGui", 5)
         if not playerGui then return end
         
         local backpackGui = playerGui:FindFirstChild("BackpackGui")
         if not backpackGui then return end
         
         local backpack = backpackGui:FindFirstChild("Backpack")
         if not backpack then return end
         
         local hotbar = backpack:FindFirstChild("Hotbar")
         if not hotbar then return end
         
         -- Search through hotbar slots
         for _, slot in pairs(hotbar:GetChildren()) do
            if slot:IsA("Frame") then
               local frame = slot:FindFirstChild("Frame")
               if frame then
                  local viewportFrame = frame:FindFirstChild("ViewportFrame")
                  if viewportFrame then
                     -- Find pickaxe model in ViewportFrame
                     for _, model in pairs(viewportFrame:GetChildren()) do
                        if model:IsA("Model") and model.Name:find("Pickaxe") then
                           local pickaxeName = model.Name
                           local pickaxeInfo = PickaxeData[pickaxeName]
                           
                           if pickaxeInfo then
                              currentPickaxePower = pickaxeInfo.MinePower
                              currentPickaxeName = pickaxeName
                              print("[⛏️] Detected:", pickaxeName, "| Mine Power:", currentPickaxePower)
                              return
                           else
                              print("[⚠️] Unknown pickaxe:", pickaxeName)
                              currentPickaxeName = pickaxeName
                              currentPickaxePower = 4
                              return
                           end
                        end
                     end
                  end
               end
            end
         end
         
         print("[⚠️] No pickaxe found in hotbar!")
      end)
      
      if not success then
         print("[❌] Failed to detect pickaxe - using default (Stone = 4)")
         currentPickaxePower = 4
         currentPickaxeName = "Unknown"
      end
   end
   
   local function canMineRock(rockType)
      local rockData = RockData[rockType]
      if not rockData then return false end
      
      return currentPickaxePower >= rockData.RequiredDamage
   end
   
   -- SMART ORE-TO-ROCK MAPPING
   local function getBestRockForOre(oreName)
      local candidates = {}
      
      for rockType, data in pairs(RockData) do
         for _, ore in pairs(data.Ores) do
            if ore == oreName then
               table.insert(candidates, {
                  rock = rockType,
                  luckBoost = data.LuckBoost,
                  requiredDamage = data.RequiredDamage,
                  health = data.Health,
                  canMine = currentPickaxePower >= data.RequiredDamage
               })
               break
            end
         end
      end
      
      if #candidates == 0 then
         print("[⚠️] No rock found for ore:", oreName)
         return nil
      end
      
      -- Filter mineable rocks
      local mineable = {}
      for _, cand in pairs(candidates) do
         if cand.canMine then
            table.insert(mineable, cand)
         end
      end
      
      -- If no mineable rocks, return info about requirement
      if #mineable == 0 then
         table.sort(candidates, function(a, b)
            return a.requiredDamage < b.requiredDamage
         end)
         local easiest = candidates[1]
         print("[❌] Cannot mine", oreName, "- Need", easiest.requiredDamage, "power, have", currentPickaxePower, "(", currentPickaxeName, ")")
         return nil, easiest.requiredDamage
      end
      
      -- Sort by Luck Boost (higher = better)
      table.sort(mineable, function(a, b)
         return a.luckBoost > b.luckBoost
      end)
      
      local best = mineable[1]
      print("[🎯] Best rock for", oreName, "=", best.rock, "(Luck:", best.luckBoost, "| Req:", best.requiredDamage, "| Your power:", currentPickaxePower, ")")
      return best.rock, best.requiredDamage
   end
   
   -- INDEX DETECTION
   local function getIndexGUI()
      local playerGui = LocalPlayer:WaitForChild("PlayerGui", 5)
      if not playerGui then return nil end
      
      local menu = playerGui:FindFirstChild("Menu")
      if not menu then return nil end
      
      local frame = menu:FindFirstChild("Frame")
      if not frame then return nil end
      
      local frame2 = frame:FindFirstChild("Frame")
      if not frame2 then return nil end
      
      local menus = frame2:FindFirstChild("Menus")
      if not menus then return nil end
      
      return menus:FindFirstChild("Index")
   end
   
   local function getOresPage()
      local indexGUI = getIndexGUI()
      if not indexGUI then return nil end
      
      local pages = indexGUI:FindFirstChild("Pages")
      if not pages then return nil end
      
      return pages:FindFirstChild("Ores")
   end
   
   local function getAvailableIndexAreas()
      local oresPage = getOresPage()
      if not oresPage then 
         print("[⚠️] INDEX: Could not find Ores page")
         return {"All Areas"}
      end
      
      local areas = {"All Areas"}
      
      for _, child in pairs(oresPage:GetChildren()) do
         if child:IsA("Frame") and not child.Name:find("List") and child.Name ~= "UIListLayout" and child.Name ~= "UIGridLayout" then
            table.insert(areas, child.Name)
         end
      end
      
      print("[INDEX] 📍 Found", #areas - 1, "areas:", table.concat(areas, ", "))
      return areas
   end
   
   local function isItemUnlocked(itemFrame)
      if not itemFrame then return false end
      
      local main = itemFrame:FindFirstChild("Main")
      if not main then return false end
      
      local itemName = main:FindFirstChild("ItemName")
      if not itemName or not itemName:IsA("TextLabel") then return false end
      
      return itemName.Text ~= "?"
   end
   
   local function isAreaSelected(areaName)
      for _, selected in pairs(selectedIndexAreas) do
         if selected == "All Areas" then return true end
         if selected == areaName then return true end
      end
      return false
   end
   
   local function detectIndexItems(silent)
      local oresPage = getOresPage()
      if not oresPage then 
         if not silent then print("[❌] INDEX: Pages > Ores not found!") end
         return {}, {}
      end
      
      local unlockedItems = {}
      local lockedItems = {}
      local totalItems = 0
      
      if not silent then print("[INDEX] 🔍 Scanning selected areas...") end
      
      for _, areaFrame in pairs(oresPage:GetChildren()) do
         if areaFrame:IsA("Frame") and not areaFrame.Name:find("List") then
            local areaName = areaFrame.Name
            
            if isAreaSelected(areaName) then
               if not silent then print("[INDEX] 📍 Area:", areaName) end
               
               local areaList = oresPage:FindFirstChild(areaName .. " List")
               
               if areaList then
                  if not silent then print("[INDEX]   📋 Scanning", areaName, "List...") end
                  
                  for _, oreFrame in pairs(areaList:GetChildren()) do
                     if oreFrame:IsA("Frame") and oreFrame.Name ~= "UIListLayout" and oreFrame.Name ~= "UIGridLayout" then
                        totalItems = totalItems + 1
                        local oreName = oreFrame.Name
                        local unlocked = isItemUnlocked(oreFrame)
                        
                        if unlocked then
                           table.insert(unlockedItems, {area = areaName, ore = oreName})
                           if not silent then print("[INDEX]     [✅] UNLOCKED:", oreName) end
                        else
                           table.insert(lockedItems, {area = areaName, ore = oreName})
                           if not silent then print("[INDEX]     [🔒] LOCKED:", oreName) end
                        end
                     end
                  end
               end
            end
         end
      end
      
      if not silent then
         print("[INDEX] 📊 Summary:")
         print("  Total:", totalItems, "| Unlocked:", #unlockedItems, "| Locked:", #lockedItems)
         if totalItems > 0 then
            print("  Progress:", string.format("%.1f%%", (#unlockedItems / totalItems) * 100))
         end
      end
      
      return unlockedItems, lockedItems
   end
   
   local function getNextMineableOre(lockedList)
      for _, item in pairs(lockedList) do
         local bestRock, reqDamage = getBestRockForOre(item.ore)
         if bestRock then
            return item, bestRock, reqDamage
         end
      end
      
      if #lockedList > 0 then
         local firstLocked = lockedList[1]
         local _, reqDamage = getBestRockForOre(firstLocked.ore)
         print("[❌] No mineable ores! Need", reqDamage, "+ power (have", currentPickaxePower, "from", currentPickaxeName, ")")
         if Rayfield then
            Rayfield:Notify({
               Title = "Pickaxe Too Weak!",
               Content = "Need " .. (reqDamage or "?") .. "+ power. Have " .. currentPickaxePower .. " (" .. currentPickaxeName .. ")",
               Duration = 6
            })
         end
      end
      
      return nil, nil, nil
   end
   
   local function checkForNewUnlocks()
      local newUnlocked, newLocked = detectIndexItems(true)
      
      local newlyUnlocked = {}
      for _, newItem in pairs(newUnlocked) do
         local wasLocked = false
         for _, oldLocked in pairs(cachedLockedItems) do
            if oldLocked.ore == newItem.ore and oldLocked.area == newItem.area then
               wasLocked = true
               break
            end
         end
         if wasLocked then table.insert(newlyUnlocked, newItem) end
      end
      
      cachedUnlockedItems = newUnlocked
      cachedLockedItems = newLocked
      
      if #newlyUnlocked > 0 then
         for _, item in pairs(newlyUnlocked) do
            print("[INDEX] 🎉 NEW UNLOCK:", item.ore, "in", item.area)
         end
         if Rayfield then
            Rayfield:Notify({
               Title = "Index Progress!",
               Content = "Unlocked: " .. newlyUnlocked[1].ore .. " (" .. #newLocked .. " left)",
               Duration = 3
            })
         end
         
         if #newLocked > 0 then
            local nextItem, bestRock, reqDamage = getNextMineableOre(newLocked)
            if bestRock and nextItem then
               currentTargetOre = nextItem.ore
               selectedRockTypes = {bestRock}
               print("[🔄] Switching to:", bestRock, "for", nextItem.ore)
            end
         end
      end
      
      return newUnlocked, newLocked
   end
   
   local function startIndexFarm()
      if indexFarmConnection then indexFarmConnection:Disconnect() end
      
      print("[INDEX FARM] Starting...")
      print("[INDEX FARM] Selected areas:", table.concat(selectedIndexAreas, ", "))
      
      detectPlayerPickaxe()
      
      if Rayfield then
         Rayfield:Notify({
            Title = "Index Farm",
            Content = "Pickaxe: " .. currentPickaxeName .. " (" .. currentPickaxePower .. " power)",
            Duration = 4
         })
      end
      
      local unlocked, locked = detectIndexItems(false)
      cachedUnlockedItems = unlocked
      cachedLockedItems = locked
      
      if #locked == 0 then
         print("[✅] All items unlocked!")
         if Rayfield then
            Rayfield:Notify({
               Title = "Index Complete!",
               Content = "All mining items unlocked! 🎉",
               Duration = 5
            })
         end
         indexFarmEnabled = false
         return
      end
      
      local firstItem, bestRock, reqDamage = getNextMineableOre(locked)
      
      if not bestRock then
         indexFarmEnabled = false
         return
      end
      
      currentTargetOre = firstItem.ore
      selectedRockTypes = {bestRock}
      print("[🎯] Farming:", bestRock, "for", firstItem.ore)
      
      if Rayfield then
         Rayfield:Notify({
            Title = "Index Farm",
            Content = "Farming " .. bestRock .. " for " .. firstItem.ore,
            Duration = 4
         })
      end
      
      totalDamageDone = 0
      lastIndexCheck = tick()
      
      indexFarmConnection = RunService.Heartbeat:Connect(function()
         if not indexFarmEnabled then return end
         
         local currentTime = tick()
         if currentTime - lastIndexCheck < INDEX_CHECK_INTERVAL then return end
         lastIndexCheck = currentTime
         
         local unlocked, locked = checkForNewUnlocks()
         
         if #locked == 0 then
            print("[✅] INDEX FARM: Complete!")
            if Rayfield then
               Rayfield:Notify({
                  Title = "Index Complete!",
                  Content = "All items unlocked! 🎉",
                  Duration = 5
               })
            end
            indexFarmEnabled = false
            return
         end
         
         print("[INDEX] 🔄 Farming:", currentTargetOre or "?", "| Locked:", #locked, "| Damage:", totalDamageDone)
      end)
   end
   
   local function stopIndexFarm()
      if indexFarmConnection then 
         indexFarmConnection:Disconnect()
         indexFarmConnection = nil
      end
      cachedUnlockedItems = {}
      cachedLockedItems = {}
      currentTargetOre = nil
      totalDamageDone = 0
      print("[INDEX FARM] Stopped")
   end
   
   print("[MINING] ✅ Loaded with Fixed Pickaxe Detection!")
   print("[MINING] 📊 Rock DB: 13 types | Pickaxe DB: 14 types")
   
   -- Note: Mining functions (startMining, stopMining, UI) need to be added
   -- This is a partial implementation focusing on pickaxe detection
end