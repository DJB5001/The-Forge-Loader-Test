-- dj_tab_mining.lua
-- Auto Mining + Auto Finish Mining Index (Dynamic Areas)

return function(Window, Rayfield, Utils)
   local MiningTab = Window:CreateTab("⛏️ Mining", nil)
   
   MiningTab:CreateSection("Configuration")
   
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")
   
   local miningEnabled = false
   local indexFarmEnabled = false
   local selectedRockTypes = {"Boulder"}
   local selectedLocation = "Island1CaveDeep"
   local selectedIndexAreas = {"All Areas"}
   local miningConnection = nil
   local indexFarmConnection = nil
   local noclipConnection = nil
   local flyConnection = nil
   local currentTargetRock = nil
   local isMovingToRock = false
   local flySpeed = 60
   local bodyVelocity = nil
   local bodyGyro = nil
   local characterAddedConnection = nil
   local rockStartTime = 0
   local ROCK_TIMEOUT = 360
   local currentRockTypeIndex = 1
   local lastIndexCheck = 0
   local INDEX_CHECK_INTERVAL = 5
   local cachedUnlockedItems = {}
   local cachedLockedItems = {}
   local availableIndexAreas = {"All Areas"}
   
   local rockLocations = {
      "All",
      "Island1CaveDeep",
      "Island1CaveMid",
      "Island1CaveStart",
      "Roof",
      "Island2CaveDanger1",
      "Island2CaveDanger2",
      "Island2CaveDanger3",
      "Island2CaveDanger4",
      "Island2CaveDangerClosed",
      "Island2CaveDeep",
      "Island2CaveLavaClosed",
      "Island2CaveMid",
      "Island2CaveStart",
      "Island2GoblinCave",
      "Island2VolcanicDepths"
   }
   
   local rockTypes = {
      "Rock",
      "Boulder",
      "Pebble",
      "LuckyBlock",
      "Light Crystal",
      "Volcanic Rock",
      "Basalt Core",
      "Basalt Rock",
      "Basalt Vein",
      "Violet Crystal",
      "Earth Crystal",
      "Cyan Crystal",
      "Crimson Crystal"
   }
   
   print("[MINING] Loading with Index Farm...")
   
   -- INDEX DETECTION SYSTEM
   local function getIndexGUI()
      local playerGui = LocalPlayer:WaitForChild("PlayerGui", 5)
      if not playerGui then return nil end
      
      local menu = playerGui:FindFirstChild("Menu")
      if not menu then return nil end
      
      local frame = menu:FindFirstChild("Frame")
      if not frame then return nil end
      
      local frame2 = frame:FindFirstChild("Frame")
      if not frame2 then return nil end
      
      local menus = frame2:FindFirstChild("Menus")
      if not menus then return nil end
      
      local index = menus:FindFirstChild("Index")
      return index
   end
   
   local function getOresPage()
      local indexGUI = getIndexGUI()
      if not indexGUI then return nil end
      
      local pages = indexGUI:FindFirstChild("Pages")
      if not pages then return nil end
      
      local ores = pages:FindFirstChild("Ores")
      return ores
   end
   
   local function getAvailableIndexAreas()
      local oresPage = getOresPage()
      if not oresPage then 
         print("[⚠️] INDEX: Could not find Ores page")
         return {"All Areas"}
      end
      
      local areas = {"All Areas"}
      
      -- Scan for actual area frames
      for _, child in pairs(oresPage:GetChildren()) do
         if child:IsA("Frame") and not child.Name:find("List") and child.Name ~= "UIListLayout" and child.Name ~= "UIGridLayout" then
            table.insert(areas, child.Name)
         end
      end
      
      print("[INDEX] 📍 Found", #areas - 1, "areas:", table.concat(areas, ", "))
      return areas
   end
   
   local function isItemUnlocked(itemFrame)
      if not itemFrame then return false end
      
      local main = itemFrame:FindFirstChild("Main")
      if not main then return false end
      
      local itemName = main:FindFirstChild("ItemName")
      if not itemName or not itemName:IsA("TextLabel") then return false end
      
      local text = itemName.Text
      if text == "?" then
         return false
      else
         return true
      end
   end
   
   local function isAreaSelected(areaName)
      -- Check if "All Areas" is selected
      for _, selected in pairs(selectedIndexAreas) do
         if selected == "All Areas" then return true end
      end
      
      -- Check if specific area is selected
      for _, selected in pairs(selectedIndexAreas) do
         if selected == areaName then return true end
      end
      
      return false
   end
   
   local function detectIndexItems(silent)
      local oresPage = getOresPage()
      if not oresPage then 
         if not silent then
            print("[❌] INDEX: Pages > Ores not found!")
         end
         return {}, {}
      end
      
      local unlockedItems = {}
      local lockedItems = {}
      local totalItems = 0
      
      if not silent then
         print("[INDEX] 🔍 Scanning selected areas...")
      end
      
      -- Iterate through AREAS
      for _, areaFrame in pairs(oresPage:GetChildren()) do
         if areaFrame:IsA("Frame") and not areaFrame.Name:find("List") then
            local areaName = areaFrame.Name
            
            -- Only scan selected areas
            if isAreaSelected(areaName) then
               if not silent then
                  print("[INDEX] 📍 Area:", areaName)
               end
               
               local areaList = oresPage:FindFirstChild(areaName .. " List")
               
               if areaList then
                  if not silent then
                     print("[INDEX]   📋 Scanning", areaName, "List...")
                  end
                  
                  for _, oreFrame in pairs(areaList:GetChildren()) do
                     if oreFrame:IsA("Frame") and oreFrame.Name ~= "UIListLayout" and oreFrame.Name ~= "UIGridLayout" then
                        totalItems = totalItems + 1
                        local oreName = oreFrame.Name
                        local unlocked = isItemUnlocked(oreFrame)
                        
                        if unlocked then
                           table.insert(unlockedItems, {area = areaName, ore = oreName})
                           if not silent then
                              print("[INDEX]     [✅] UNLOCKED:", oreName)
                           end
                        else
                           table.insert(lockedItems, {area = areaName, ore = oreName})
                           if not silent then
                              print("[INDEX]     [🔒] LOCKED:", oreName)
                           end
                        end
                     end
                  end
               end
            end
         end
      end
      
      if not silent then
         print("[INDEX] 📊 Summary:")
         print("  Total Items:", totalItems)
         print("  Unlocked:", #unlockedItems)
         print("  Locked:", #lockedItems)
         if totalItems > 0 then
            print("  Progress:", string.format("%.1f%%", (#unlockedItems / totalItems) * 100))
         end
      end
      
      return unlockedItems, lockedItems
   end
   
   local function checkForNewUnlocks()
      local newUnlocked, newLocked = detectIndexItems(true)
      
      -- Check if any new items were unlocked
      local newlyUnlocked = {}
      for _, newItem in pairs(newUnlocked) do
         local wasLocked = false
         for _, oldLocked in pairs(cachedLockedItems) do
            if oldLocked.ore == newItem.ore and oldLocked.area == newItem.area then
               wasLocked = true
               break
            end
         end
         if wasLocked then
            table.insert(newlyUnlocked, newItem)
         end
      end
      
      -- Update cache
      cachedUnlockedItems = newUnlocked
      cachedLockedItems = newLocked
      
      -- Notify about new unlocks
      if #newlyUnlocked > 0 then
         for _, item in pairs(newlyUnlocked) do
            print("[INDEX] 🎉 NEW UNLOCK:", item.ore, "in", item.area)
         end
         if Rayfield then
            Rayfield:Notify({
               Title = "Index Progress!",
               Content = "Unlocked: " .. newlyUnlocked[1].ore .. " (" .. #newLocked .. " left)",
               Duration = 3
            })
         end
      end
      
      return newUnlocked, newLocked
   end
   
   local function getNextLockedItem()
      if #cachedLockedItems == 0 then
         print("[✅] INDEX: All items unlocked!")
         return nil
      end
      
      local nextItem = cachedLockedItems[1]
      print("[🎯] INDEX: Next target =", nextItem.ore, "in", nextItem.area)
      return nextItem
   end
   
   local function startIndexFarm()
      if indexFarmConnection then indexFarmConnection:Disconnect() end
      
      print("[INDEX FARM] Starting...")
      print("[INDEX FARM] Selected areas:", table.concat(selectedIndexAreas, ", "))
      
      if Rayfield then
         Rayfield:Notify({
            Title = "Index Farm",
            Content = "Scanning for locked items...",
            Duration = 3
         })
      end
      
      -- Initial scan
      local unlocked, locked = detectIndexItems(false)
      cachedUnlockedItems = unlocked
      cachedLockedItems = locked
      
      if #locked == 0 then
         print("[✅] All selected items already unlocked!")
         if Rayfield then
            Rayfield:Notify({
               Title = "Index Complete!",
               Content = "All mining items unlocked! 🎉",
               Duration = 5
            })
         end
         indexFarmEnabled = false
         return
      end
      
      lastIndexCheck = tick()
      
      indexFarmConnection = RunService.Heartbeat:Connect(function()
         if not indexFarmEnabled then return end
         
         local currentTime = tick()
         if currentTime - lastIndexCheck < INDEX_CHECK_INTERVAL then return end
         lastIndexCheck = currentTime
         
         -- Check for updates
         local unlocked, locked = checkForNewUnlocks()
         
         if #locked == 0 then
            print("[✅] INDEX FARM: Complete!")
            if Rayfield then
               Rayfield:Notify({
                  Title = "Index Complete!",
                  Content = "All mining items unlocked! 🎉",
                  Duration = 5
               })
            end
            indexFarmEnabled = false
            return
         end
         
         -- Get next target
         local nextItem = getNextLockedItem()
         if nextItem then
            print("[INDEX] 🔄 Still farming:", nextItem.ore, "(", #locked, "locked )")
         end
      end)
   end
   
   local function stopIndexFarm()
      if indexFarmConnection then 
         indexFarmConnection:Disconnect()
         indexFarmConnection = nil
      end
      cachedUnlockedItems = {}
      cachedLockedItems = {}
      print("[INDEX FARM] Stopped")
   end
   
   -- MINING FUNCTIONS
   local function findNextRock(locationFilter)
      if #selectedRockTypes == 0 then return nil, nil end
      
      local rocksFolder = workspace:FindFirstChild("Rocks")
      if not rocksFolder then return nil, nil end
      
      local locationsToSearch = {}
      if locationFilter == "All" then
         for i = 2, #rockLocations do
            table.insert(locationsToSearch, rockLocations[i])
         end
      else
         locationsToSearch = {locationFilter}
      end
      
      for i = 1, #selectedRockTypes do
         local index = ((currentRockTypeIndex - 1 + i - 1) % #selectedRockTypes) + 1
         local rockType = selectedRockTypes[index]
         
         for _, locationName in ipairs(locationsToSearch) do
            local locationFolder = rocksFolder:FindFirstChild(locationName)
            
            if locationFolder then
               for _, child in pairs(locationFolder:GetChildren()) do
                  if child.Name == "SpawnLocation" then
                     local rock = child:FindFirstChild(rockType)
                     if rock then
                        currentRockTypeIndex = index
                        return rock, child
                     end
                  end
               end
            end
         end
      end
      
      return nil, nil
   end
   
   local function enableNoclip()
      if noclipConnection then return end
      noclipConnection = RunService.Stepped:Connect(function()
         if not miningEnabled then return end
         local character = LocalPlayer.Character
         if character then
            for _, part in pairs(character:GetDescendants()) do
               if part:IsA("BasePart") then part.CanCollide = false end
            end
         end
      end)
   end
   
   local function disableNoclip()
      if noclipConnection then noclipConnection:Disconnect(); noclipConnection = nil end
      local character = LocalPlayer.Character
      if character then
         for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
         end
      end
   end
   
   local function setupFlyBodies()
      local character = LocalPlayer.Character
      if not character then return false end
      local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
      if not humanoidRootPart then return false end
      
      for _, obj in pairs(humanoidRootPart:GetChildren()) do
         if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
      end
      
      bodyVelocity = Instance.new("BodyVelocity")
      bodyVelocity.Velocity = Vector3.new(0, 0, 0)
      bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
      bodyVelocity.Parent = humanoidRootPart
      
      bodyGyro = Instance.new("BodyGyro")
      bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
      bodyGyro.P = 9e4
      bodyGyro.Parent = humanoidRootPart
      return true
   end
   
   local function enableFly()
      if flyConnection then return end
      if not setupFlyBodies() then task.wait(0.5); setupFlyBodies() end
      
      flyConnection = RunService.Heartbeat:Connect(function()
         if not miningEnabled or not bodyVelocity or not bodyGyro then return end
         local char = LocalPlayer.Character
         if not char then return end
         local hrp = char:FindFirstChild("HumanoidRootPart")
         if not hrp then return end
         
         if isMovingToRock and currentTargetRock then
            local hitbox = currentTargetRock:FindFirstChild("Hitbox")
            
            if hitbox and hitbox:IsA("BasePart") then
               local hitboxPos = hitbox.Position
               local targetPos = hitboxPos - Vector3.new(0, 2, 0)
               
               local direction = (targetPos - hrp.Position).Unit
               local distance = (targetPos - hrp.Position).Magnitude
               local maxSpeed = math.min(flySpeed, 60)
               local speed = math.min(distance * 2, maxSpeed)
               
               if distance > 2 then
                  bodyVelocity.Velocity = direction * speed
                  bodyGyro.CFrame = CFrame.new(hrp.Position, targetPos)
               else
                  bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                  isMovingToRock = false
               end
            else
               local rockPart = currentTargetRock.PrimaryPart or currentTargetRock:FindFirstChildWhichIsA("BasePart")
               if rockPart then
                  local targetPos = rockPart.Position - Vector3.new(0, 2, 0)
                  local direction = (targetPos - hrp.Position).Unit
                  local distance = (targetPos - hrp.Position).Magnitude
                  local speed = math.min(distance * 2, math.min(flySpeed, 60))
                  
                  if distance > 2 then
                     bodyVelocity.Velocity = direction * speed
                     bodyGyro.CFrame = CFrame.new(hrp.Position, targetPos)
                  else
                     bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                     isMovingToRock = false
                  end
               else
                  bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                  isMovingToRock = false
               end
            end
         else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
         end
      end)
   end
   
   local function disableFly()
      if flyConnection then flyConnection:Disconnect(); flyConnection = nil end
      if bodyVelocity then bodyVelocity:Destroy(); bodyVelocity = nil end
      if bodyGyro then bodyGyro:Destroy(); bodyGyro = nil end
   end
   
   local function moveToRock(rock)
      if not rock then return false end
      
      if rock ~= currentTargetRock then
         rockStartTime = tick()
         print("[MINING] Target:", rock.Name)
      end
      
      currentTargetRock = rock
      isMovingToRock = true
      return true
   end
   
   local function activateMiningTool()
      if not miningEnabled then return end
      task.spawn(function()
         pcall(function()
            local args = {"Pickaxe"}
            game:GetService("ReplicatedStorage")
               :WaitForChild("Shared", 1):WaitForChild("Packages", 1):WaitForChild("Knit", 1)
               :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
               :WaitForChild("RF", 1):WaitForChild("ToolActivated", 1)
               :InvokeServer(unpack(args))
         end)
      end)
   end
   
   local function isRockValid(rock)
      if not rock then return false end
      if not rock.Parent then return false end
      
      local currentTime = tick()
      local timeMining = currentTime - rockStartTime
      
      if timeMining > ROCK_TIMEOUT then
         print("[MINING] Timeout (6min) - switching rock...")
         return false
      end
      
      return true
   end
   
   local function startMining()
      if miningConnection then miningConnection:Disconnect() end
      
      local rockList = table.concat(selectedRockTypes, ", ")
      print("[MINING] Starting:", rockList)
      
      enableNoclip()
      task.wait(0.1)
      enableFly()
      
      if Rayfield then
         Rayfield:Notify({
            Title = "Mining", 
            Content = "Mining: " .. (#selectedRockTypes > 1 and (#selectedRockTypes .. " types") or selectedRockTypes[1]), 
            Duration = 3
         })
      end
      
      local searchTick, spamCount = 0, 0
      local newRock = findNextRock(selectedLocation)
      if newRock then moveToRock(newRock) end
      
      miningConnection = RunService.Heartbeat:Connect(function()
         if not miningEnabled then return end
         searchTick = searchTick + 1
         
         if not isRockValid(currentTargetRock) or searchTick >= 60 then
            searchTick = 0
            local rock = findNextRock(selectedLocation)
            if rock and rock ~= currentTargetRock then 
               moveToRock(rock)
            end
         end
         
         activateMiningTool()
         spamCount = spamCount + 1
         if spamCount >= 200 then spamCount = 0 end
      end)
   end
   
   local function stopMining()
      if miningConnection then miningConnection:Disconnect(); miningConnection = nil end
      disableNoclip()
      disableFly()
      currentTargetRock = nil
      isMovingToRock = false
      rockStartTime = 0
      currentRockTypeIndex = 1
      print("[MINING] Stopped")
   end
   
   local function setupRespawnHandler()
      if characterAddedConnection then characterAddedConnection:Disconnect() end
      
      characterAddedConnection = LocalPlayer.CharacterAdded:Connect(function(newCharacter)
         if miningEnabled then
            print("[MINING] Respawned - restarting...")
            task.wait(1)
            disableFly()
            task.wait(0.5)
            enableNoclip()
            task.wait(0.1)
            enableFly()
            
            currentTargetRock = nil
            isMovingToRock = false
            rockStartTime = 0
            local newRock = findNextRock(selectedLocation)
            if newRock then moveToRock(newRock) end
         end
      end)
   end
   
   setupRespawnHandler()
   
   -- Detect available Index areas on load
   task.spawn(function()
      task.wait(2)
      availableIndexAreas = getAvailableIndexAreas()
   end)
   
   -- UI
   MiningTab:CreateDropdown({
      Name = "Location",
      Options = rockLocations,
      CurrentOption = {"Island1CaveDeep"},
      MultipleOptions = false,
      Flag = "MiningLocation",
      Callback = function(Options)
         selectedLocation = Options[1] or "All"
      end,
   })
   
   MiningTab:CreateDropdown({
      Name = "Rock Types (Multi-Select)",
      Options = rockTypes,
      CurrentOption = {"Boulder"},
      MultipleOptions = true,
      Flag = "MiningRockTypes",
      Callback = function(Options)
         selectedRockTypes = Options
         if #selectedRockTypes == 0 then
            selectedRockTypes = {"Boulder"}
         end
         currentRockTypeIndex = 1
         print("[MINING] Selected:", table.concat(selectedRockTypes, ", "))
      end,
   })
   
   MiningTab:CreateSlider({
      Name = "Fly Speed (Max 60)",
      Range = {30, 60},
      Increment = 5,
      Suffix = "Speed",
      CurrentValue = 60,
      Flag = "MiningFlySpeed",
      Callback = function(Value)
         flySpeed = Value
      end,
   })
   
   MiningTab:CreateSection("Control")
   
   MiningTab:CreateToggle({
      Name = "Auto Mining",
      CurrentValue = false,
      Flag = "AutoMining",
      Callback = function(enabled)
         miningEnabled = enabled
         if enabled then
            startMining()
         else
            stopMining()
         end
      end,
   })
   
   MiningTab:CreateSection("Mining Index")
   
   local indexAreasDropdown = MiningTab:CreateDropdown({
      Name = "Index Areas (Multi-Select)",
      Options = availableIndexAreas,
      CurrentOption = {"All Areas"},
      MultipleOptions = true,
      Flag = "IndexAreas",
      Callback = function(Options)
         selectedIndexAreas = Options
         if #selectedIndexAreas == 0 then
            selectedIndexAreas = {"All Areas"}
         end
         print("[INDEX] Selected areas:", table.concat(selectedIndexAreas, ", "))
      end,
   })
   
   MiningTab:CreateButton({
      Name = "🔄 Refresh Available Areas",
      Callback = function()
         availableIndexAreas = getAvailableIndexAreas()
         indexAreasDropdown:Refresh(availableIndexAreas, true)
         if Rayfield then
            Rayfield:Notify({
               Title = "Areas Refreshed",
               Content = "Found " .. (#availableIndexAreas - 1) .. " Index areas!",
               Duration = 3
            })
         end
      end,
   })
   
   MiningTab:CreateToggle({
      Name = "Auto Finish Mining Index",
      CurrentValue = false,
      Flag = "AutoFinishMiningIndex",
      Callback = function(enabled)
         indexFarmEnabled = enabled
         if enabled then
            startIndexFarm()
         else
            stopIndexFarm()
         end
      end,
   })
   
   MiningTab:CreateParagraph({
      Title = "📚 Index Farm Info",
      Content = "Dynamically detects available\nIndex areas (usually 3)!\n\nClick 'Refresh Areas' to update\nthe dropdown with real areas.\n\nAuto-refreshes progress every 5s.\nNotifies when items unlock!"
   })
   
   MiningTab:CreateParagraph({
      Title = "Multi-Rock Mining",
      Content = "Select MULTIPLE rock types!\nAuto-switches when unavailable.\n\n13 Rock Types + Multi-select\n17 Locations | World 1 & 2\nAuto fly + noclip\n6-min timeout system"
   })
   
   print("[MINING] ✅ Ready with Dynamic Index Areas!")
   
   game:GetService("Players").PlayerRemoving:Connect(function(player)
      if player == LocalPlayer then 
         stopMining()
         stopIndexFarm()
         if characterAddedConnection then characterAddedConnection:Disconnect() end
      end
   end)
end