-- dj_tab_misc.lua — Save/Load with UI restore
return function(Window, Rayfield, Utils)
    local PLACEHOLDER = "— Select save —"

    local function have(fn) return type(_G[fn]) == "function" end
    local function notify(msg, dur) Rayfield:Notify({ Title = "DJ HUB", Content = tostring(msg), Duration = dur or 3 }) end

    local tab = Window:CreateTab("⚙️ Misc", nil)
    tab:CreateSection("Save / Load Settings")

    local dropdown, ddNode, selected = nil, nil, nil

    local function normalizeSelection(opt)
        if type(opt) == "table" then opt = opt[1] end
        if type(opt) ~= "string" or opt == PLACEHOLDER then return nil end
        local nm = tostring(opt):gsub("^%s+",""):gsub("%s+$","")
        return (nm ~= "" and nm) or nil
    end

    local function listRaw()
        if not have("listSettings") then return {} end
        local ok, items = pcall(_G.listSettings)
        if not ok or type(items) ~= "table" then return {} end
        table.sort(items, function(a,b) return (a.time or 0) > (b.time or 0) end)
        return items
    end

    local function formatOptions()
        local items = listRaw()
        if #items == 0 then return { PLACEHOLDER } end
        local opts = { PLACEHOLDER }
        for _, it in ipairs(items) do
            table.insert(opts, tostring(it.name or "?"))
        end
        return opts
    end

    local function collapseDropdown()
        pcall(function()
            if dropdown then
                if dropdown.Toggled ~= nil then dropdown.Toggled = false end
                if dropdown.Opened  ~= nil then dropdown.Opened  = false end
                if dropdown.Open    ~= nil then dropdown.Open    = false end
            end
        end)
        pcall(function()
            local n = (dropdown and (dropdown.Instance or dropdown.Dropdown or dropdown.Frame or dropdown.Holder or dropdown.Container)) or ddNode
            if n then
                local holder = dropdown and (dropdown.Holder or dropdown.Container) or nil
                if holder and holder.Visible ~= nil then holder.Visible = false end
                local fly = n:FindFirstChild("DropdownFrame") or n:FindFirstChild("Frame") or n:FindFirstChild("ScrollingFrame") or n:FindFirstChild("DropdownList")
                if fly and fly.Visible ~= nil then fly.Visible = false end
            end
        end)
        pcall(function()
            local n = (dropdown and (dropdown.Instance or dropdown.Dropdown or dropdown.Frame)) or ddNode
            local holder = dropdown and (dropdown.Holder or dropdown.Container)
            local isOpen = holder and holder.Visible == true
            if n and isOpen then
                local btn = n:FindFirstChild("Button") or n:FindFirstChild("Open") or n:FindFirstChildWhichIsA("ImageButton") or n:FindFirstChildWhichIsA("TextButton")
                if btn and btn.Activated then btn:Activate()
                elseif btn and btn.MouseButton1Click then btn:Activate() end
            end
        end)
        pcall(function() if dropdown and dropdown.Set then dropdown:Set(PLACEHOLDER) end end)
    end

    local function destroyDropdown()
        pcall(function() if dropdown and dropdown.Instance and dropdown.Instance.Destroy then dropdown.Instance:Destroy() end end)
        pcall(function() if dropdown and dropdown.Frame    and dropdown.Frame.Destroy    then dropdown.Frame:Destroy()    end end)
        pcall(function() if dropdown and dropdown.Dropdown and dropdown.Dropdown.Destroy then dropdown.Dropdown:Destroy() end end)
        pcall(function() if dropdown and dropdown.Holder   and dropdown.Holder.Destroy   then dropdown.Holder:Destroy()   end end)
        pcall(function() if ddNode   and ddNode.Destroy    then ddNode:Destroy()         end end)
        dropdown, ddNode = nil, nil
    end

    local function buildDropdown(opts)
        destroyDropdown()
        dropdown = tab:CreateDropdown({
            Name = "📁 Select Save",
            Options = opts or formatOptions(),
            Callback = function(opt)
                selected = normalizeSelection(opt)
                if selected then
                    _G.__DJ_CurrentSlot = selected
                    notify("Selected: "..selected, 2)
                end
            end
        })
        ddNode = (dropdown and (dropdown.Instance or dropdown.Frame or dropdown.Dropdown or dropdown.Holder or dropdown.Container)) or nil
        pcall(function() dropdown:Set(PLACEHOLDER) end)
        collapseDropdown()
    end

    local function refreshDropdown()
        local opts = formatOptions()
        selected, _G.__DJ_CurrentSlot = nil, nil
        local refreshed = false
        if dropdown and dropdown.Refresh then
            refreshed = pcall(function()
                dropdown:Refresh(opts)
                dropdown:Set(PLACEHOLDER)
            end) == true
        end
        if not refreshed then
            buildDropdown(opts)
        else
            collapseDropdown()
        end
    end

    local saveName = ""
    tab:CreateInput({
        Name = "💾 Save Name",
        PlaceholderText = "Enter save name...",
        RemoveTextAfterFocusLost = false,
        Callback = function(txt) saveName = tostring(txt or "") end
    })

    tab:CreateButton({
        Name = "✅ Save Settings",
        Callback = function()
            if saveName == "" then return notify("Please enter a save name.", 3) end
            if not have("saveSettings") then return notify("Save system missing in loader.", 4) end
            local ok = pcall(_G.saveSettings, saveName)
            notify(ok and ("Saved as '"..saveName.."'") or "Save failed.", 3)
            refreshDropdown()
        end
    })

    tab:CreateSection("Load / Manage")
    buildDropdown(formatOptions())

    tab:CreateButton({
        Name = "📥 Load Selected",
        Callback = function()
            if not selected then return notify("Pick a save first.", 3) end
            if not have("loadSettings") then return notify("Load function missing.", 3) end
            
            local ok, res = pcall(_G.loadSettings, selected)
            if ok and res then
                notify("Loaded '"..selected.."' - Updating UI...", 3)
                
                -- Wait for flags to sync then update UI
                task.wait(0.5)
                if _G.UpdateRayfieldUI then
                    pcall(_G.UpdateRayfieldUI)
                    print("[MISC] ✅ UI restored after load")
                else
                    warn("[MISC] ⚠️ UpdateRayfieldUI not available")
                end
            else
                notify("Load failed.", 3)
            end
        end
    })

    tab:CreateButton({
        Name = "🗑️ Delete Selected",
        Callback = function()
            if not selected then return notify("Pick a save to delete.", 3) end
            if not have("deleteSettings") then return notify("Delete function missing.", 3) end
            local ok, res = pcall(_G.deleteSettings, selected)
            notify(ok and res and ("Deleted '"..selected.."'") or "Delete failed.", 3)
            refreshDropdown()
        end
    })

    tab:CreateButton({
        Name = "🔄 Refresh List",
        Callback = function()
            refreshDropdown()
            notify("List refreshed.", 2)
        end
    })

    tab:CreateSection("Links")
    tab:CreateButton({
        Name = "🌐 Copy Discord Invite",
        Callback = function()
            local link = "https://discord.gg/MTXnFfHXW9"
            if setclipboard then setclipboard(link) end
            notify("Invite copied!", 2)
        end
    })

    if _G.__DJ_Subscribe then
        _G.__DJ_Subscribe(function(evt)
            if evt == "saves:changed" then
                refreshDropdown()
            end
        end)
    end
end
