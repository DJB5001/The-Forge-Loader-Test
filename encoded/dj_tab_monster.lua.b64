-- dj_tab_monster.lua
-- Block detection: Extensive debug for No Dash detection

return function(Window, Rayfield, Utils)
   local MonsterTab = Window:CreateTab("👾 Monster Farm", nil)
   
   MonsterTab:CreateSection("Configuration")
   
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")
   local ReplicatedStorage = game:GetService("ReplicatedStorage")
   
   local farmEnabled = false
   local farmBlockingEnabled = false
   local selectedMonsters = {"Zombie"}
   local farmConnection = nil
   local noclipConnection = nil
   local flyConnection = nil
   local farmBlockConnection = nil
   local blockConnection = nil
   local currentTargetMonster = nil
   local isMovingToMonster = false
   local flySpeed = 60
   local bodyVelocity = nil
   local bodyGyro = nil
   local autoBlockEnabled = false
   local isBlocking = false
   local lastBlockCheck = 0
   local blockStartTime = 0
   local characterAddedConnection = nil
   local monsterStartTime = 0
   local MONSTER_TIMEOUT = 360
   local MAX_BLOCK_DISTANCE = 100
   local BLOCK_DURATION = 0.5
   local currentMonsterTypeIndex = 1
   local previousNoDashStates = {}
   local lastMobCheckTime = 0
   local MOB_CHECK_INTERVAL = 2
   local lastDebugTime = 0
   local DEBUG_INTERVAL = 1
   
   local monsterTypes = {
      "Bomber",
      "Skeleton Rogue",
      "Axe Skeleton",
      "Deathaxe Skeleton",
      "Elite Rogue Skeleton",
      "Elite Deathaxe Skeleton",
      "Zombie",
      "Delver Zombie",
      "Elite Zombie",
      "Brute Zombie",
      "Reaper",
      "Blight Puromancer",
      "Slime",
      "Blazing Slime"
   }
   
   print("[MONSTER FARM] 🔍 Loading with EXTENSIVE DEBUG...")
   print("[DEBUG] Script version: 2.0 - Full diagnostic mode")
   
   local function getPlayerNameFromClaim(claimValue)
      if not claimValue then return nil end
      if claimValue:IsA("Player") then return claimValue.Name end
      if claimValue:IsA("Model") then return claimValue.Name end
      if claimValue.Name then return claimValue.Name end
      return nil
   end
   
   local function isMonsterClaimedByOther(monster)
      if not monster then return false end
      local status = monster:FindFirstChild("Status")
      if not status then return false end
      local damageDone = status:FindFirstChild("DamageDone")
      if not damageDone then return false end
      local claimValue = damageDone.Value
      if not claimValue then return false end
      local claimName = getPlayerNameFromClaim(claimValue)
      if not claimName or claimName == "" then return false end
      return claimName ~= LocalPlayer.Name
   end
   
   local function isMonsterClaimedByUs(monster)
      if not monster then return false end
      local status = monster:FindFirstChild("Status")
      if not status then return false end
      local damageDone = status:FindFirstChild("DamageDone")
      if not damageDone then return false end
      local claimValue = damageDone.Value
      if not claimValue then return false end
      local claimName = getPlayerNameFromClaim(claimValue)
      if not claimName then return false end
      return claimName == LocalPlayer.Name
   end
   
   local function getDistanceToMonster(monster)
      if not monster then return math.huge end
      local char = LocalPlayer.Character
      if not char then return math.huge end
      local hrp = char:FindFirstChild("HumanoidRootPart")
      if not hrp then return math.huge end
      local monsterPart = monster:FindFirstChild("HumanoidRootPart") 
                       or monster.PrimaryPart 
                       or monster:FindFirstChildWhichIsA("BasePart")
      if not monsterPart then return math.huge end
      return (hrp.Position - monsterPart.Position).Magnitude
   end
   
   local function findAllMyMonsters()
      local living = workspace:FindFirstChild("Living")
      if not living then 
         print("[DEBUG] ❌ workspace.Living not found!")
         return {} 
      end
      
      local myMonsters = {}
      local totalMonsters = 0
      for _, entity in pairs(living:GetChildren()) do
         totalMonsters = totalMonsters + 1
         local status = entity:FindFirstChild("Status")
         if status then
            local damageDone = status:FindFirstChild("DamageDone")
            if damageDone and damageDone.Value then
               local claimName = getPlayerNameFromClaim(damageDone.Value)
               if claimName == LocalPlayer.Name then
                  local distance = getDistanceToMonster(entity)
                  if distance <= MAX_BLOCK_DISTANCE then
                     table.insert(myMonsters, entity)
                  end
               end
            end
         end
      end
      
      local currentTime = tick()
      if currentTime - lastDebugTime > DEBUG_INTERVAL then
         print("[DEBUG] 📊 Total mobs in Living:", totalMonsters)
         print("[DEBUG] 🎯 My claimed mobs:", #myMonsters)
         lastDebugTime = currentTime
      end
      
      return myMonsters
   end
   
   local function hasNoDashStatus(monster)
      if not monster then 
         print("[DEBUG] ❌ hasNoDashStatus: monster is nil")
         return false 
      end
      
      print("[DEBUG] 🔎 Checking", monster.Name, "for No Dash status...")
      
      local status = monster:FindFirstChild("Status")
      if not status then 
         print("[DEBUG] ❌", monster.Name, "has NO Status folder!")
         print("[DEBUG] 📋", monster.Name, "children:")
         for _, child in pairs(monster:GetChildren()) do
            print("[DEBUG]   -", child.Name, "(", child.ClassName, ")")
         end
         return false 
      end
      
      print("[DEBUG] ✅", monster.Name, "HAS Status folder")
      print("[DEBUG] 📋 Status folder children:")
      for _, child in pairs(status:GetChildren()) do
         print("[DEBUG]   -", child.Name, "(", child.ClassName, ")")
         if child:IsA("ValueBase") then
            print("[DEBUG]     Value:", tostring(child.Value), "Type:", type(child.Value))
         end
      end
      
      local noDash = status:FindFirstChild("No Dash")
      if not noDash then
         print("[DEBUG] ❌ 'No Dash' child NOT FOUND in Status!")
         return false
      end
      
      print("[DEBUG] ✅ 'No Dash' child FOUND!")
      print("[DEBUG] 📦 No Dash ClassName:", noDash.ClassName)
      
      local value = noDash.Value
      print("[DEBUG] 🔍 No Dash Value:", tostring(value))
      print("[DEBUG] 🔍 Value Type:", type(value))
      
      if type(value) == "boolean" then
         print("[DEBUG] 🔵 Boolean check:", value == true)
         if value == true then 
            print("[DEBUG] ✅✅✅ NO DASH IS TRUE (boolean)!")
            return true 
         end
      end
      
      if type(value) == "number" then
         print("[DEBUG] 🔢 Number check:", value, ">", 0, "=", value > 0)
         if value > 0 then 
            print("[DEBUG] ✅✅✅ NO DASH IS TRUE (number > 0)!")
            return true 
         end
      end
      
      if type(value) == "string" then
         print("[DEBUG] 🔤 String check:", value, "lower:", value:lower())
         if value:lower() == "true" or value == "1" then 
            print("[DEBUG] ✅✅✅ NO DASH IS TRUE (string)!")
            return true 
         end
      end
      
      if value ~= nil and value ~= false and value ~= 0 then 
         print("[DEBUG] ❗ Other truthy value detected!")
         print("[DEBUG] ✅✅✅ NO DASH IS TRUE (other)!")
         return true 
      end
      
      print("[DEBUG] ❌ No Dash is FALSE")
      return false
   end
   
   local function startBlock()
      if isBlocking then 
         print("[DEBUG] ⚠️ startBlock called but already blocking!")
         return 
      end
      
      print("[DEBUG] 🛡️ ATTEMPTING TO START BLOCK...")
      
      task.spawn(function()
         pcall(function()
            print("[DEBUG] 📡 Invoking StartBlock:InvokeServer()...")
            ReplicatedStorage:WaitForChild("Shared", 1)
               :WaitForChild("Packages", 1):WaitForChild("Knit", 1)
               :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
               :WaitForChild("RF", 1):WaitForChild("StartBlock", 1)
               :InvokeServer()
            isBlocking = true
            blockStartTime = tick()
            print("[FARM] 🛡️🛡️🛡️ BLOCKING STARTED (attacking stopped)")
            
            print("[DEBUG] ⏳ Waiting", BLOCK_DURATION, "seconds...")
            task.wait(BLOCK_DURATION)
            
            if isBlocking then
               print("[DEBUG] 📡 Invoking StopBlock:InvokeServer()...")
               ReplicatedStorage:WaitForChild("Shared", 1)
                  :WaitForChild("Packages", 1):WaitForChild("Knit", 1)
                  :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
                  :WaitForChild("RF", 1):WaitForChild("StopBlock", 1)
                  :InvokeServer()
               isBlocking = false
               blockStartTime = 0
               print("[FARM] ⚔️⚔️⚔️ BLOCKING STOPPED (attacking resumed)")
            end
         end)
      end)
   end
   
   local function stopBlock()
      if not isBlocking then return end
      
      task.spawn(function()
         pcall(function()
            ReplicatedStorage:WaitForChild("Shared", 1)
               :WaitForChild("Packages", 1):WaitForChild("Knit", 1)
               :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
               :WaitForChild("RF", 1):WaitForChild("StopBlock", 1)
               :InvokeServer()
            isBlocking = false
            blockStartTime = 0
            print("[FARM] Blocking stopped (manual)")
         end)
      end)
   end
   
   local function enableFarmBlocking()
      if farmBlockConnection then return end
      
      print("[FARM] 🛡️ Smart blocking enabled (No Dash detection + 0.5s block + FULL DEBUG)")
      print("[DEBUG] Block check interval: 0.02s (50 FPS)")
      
      farmBlockConnection = RunService.Heartbeat:Connect(function()
         if not farmEnabled or not farmBlockingEnabled then 
            if isBlocking then stopBlock() end
            return 
         end
         
         local currentTime = tick()
         if currentTime - lastBlockCheck < 0.02 then return end
         lastBlockCheck = currentTime
         
         local myMonsters = findAllMyMonsters()
         if #myMonsters == 0 then
            previousNoDashStates = {}
            return
         end
         
         print("[DEBUG] 🔍 Scanning", #myMonsters, "monsters for No Dash...")
         
         for _, monster in ipairs(myMonsters) do
            local monsterId = tostring(monster)
            print("[DEBUG] ------- Checking monster:", monster.Name, "-------")
            
            local currentNoDash = hasNoDashStatus(monster)
            local previousNoDash = previousNoDashStates[monsterId]
            
            print("[DEBUG] 📊 State comparison:")
            print("[DEBUG]   Current No Dash:", tostring(currentNoDash))
            print("[DEBUG]   Previous No Dash:", tostring(previousNoDash))
            print("[DEBUG]   Edge detected (false→true):", tostring(currentNoDash and not previousNoDash))
            
            if currentNoDash and not previousNoDash then
               print("[FARM] ⚡⚡⚡ NO DASH APPEARED on", monster.Name, "- STARTING BLOCK!")
               startBlock()
            end
            
            previousNoDashStates[monsterId] = currentNoDash
         end
      end)
   end
   
   local function disableFarmBlocking()
      if farmBlockConnection then 
         farmBlockConnection:Disconnect()
         farmBlockConnection = nil
      end
      if isBlocking then stopBlock() end
      previousNoDashStates = {}
      print("[FARM] Smart blocking disabled")
   end
   
   local function enableAutoBlock()
      if blockConnection then return end
      
      print("[MONSTER FARM] Manual Auto-Block enabled")
      
      blockConnection = RunService.Heartbeat:Connect(function()
         if not autoBlockEnabled then 
            if isBlocking then stopBlock() end
            return 
         end
         
         local currentTime = tick()
         if currentTime - lastBlockCheck < 0.02 then return end
         lastBlockCheck = currentTime
         
         local myMonsters = findAllMyMonsters()
         if #myMonsters == 0 then
            return
         end
         
         for _, monster in ipairs(myMonsters) do
            local monsterId = tostring(monster)
            local currentNoDash = hasNoDashStatus(monster)
            local previousNoDash = previousNoDashStates[monsterId]
            
            if currentNoDash and not previousNoDash then
               startBlock()
            end
            
            previousNoDashStates[monsterId] = currentNoDash
         end
      end)
   end
   
   local function disableAutoBlock()
      if blockConnection then 
         blockConnection:Disconnect()
         blockConnection = nil
      end
      if isBlocking then stopBlock() end
      previousNoDashStates = {}
      print("[MONSTER FARM] Manual Auto-Block disabled")
   end
   
   local function findNextMonster(excludeMonster)
      if #selectedMonsters == 0 then return nil end
      
      local living = workspace:FindFirstChild("Living")
      if not living then return nil end
      
      for i = 1, #selectedMonsters do
         local index = ((currentMonsterTypeIndex - 1 + i - 1) % #selectedMonsters) + 1
         local monsterType = selectedMonsters[index]
         
         for _, entity in pairs(living:GetChildren()) do
            if entity.Name:find("^" .. monsterType) and entity ~= excludeMonster then
               if not isMonsterClaimedByOther(entity) then
                  currentMonsterTypeIndex = index
                  return entity
               end
            end
         end
      end
      
      return nil
   end
   
   local function enableNoclip()
      if noclipConnection then return end
      noclipConnection = RunService.Stepped:Connect(function()
         if not farmEnabled then return end
         local character = LocalPlayer.Character
         if character then
            for _, part in pairs(character:GetDescendants()) do
               if part:IsA("BasePart") then part.CanCollide = false end
            end
         end
      end)
   end
   
   local function disableNoclip()
      if noclipConnection then noclipConnection:Disconnect(); noclipConnection = nil end
      local character = LocalPlayer.Character
      if character then
         for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
         end
      end
   end
   
   local function setupFlyBodies()
      local character = LocalPlayer.Character
      if not character then return false end
      local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
      if not humanoidRootPart then return false end
      
      for _, obj in pairs(humanoidRootPart:GetChildren()) do
         if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
      end
      
      bodyVelocity = Instance.new("BodyVelocity")
      bodyVelocity.Velocity = Vector3.new(0, 0, 0)
      bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
      bodyVelocity.Parent = humanoidRootPart
      
      bodyGyro = Instance.new("BodyGyro")
      bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
      bodyGyro.P = 9e4
      bodyGyro.Parent = humanoidRootPart
      return true
   end
   
   local function enableFly()
      if flyConnection then return end
      if not setupFlyBodies() then task.wait(0.5); setupFlyBodies() end
      
      flyConnection = RunService.Heartbeat:Connect(function()
         if not farmEnabled or not bodyVelocity or not bodyGyro then return end
         local char = LocalPlayer.Character
         if not char then return end
         local hrp = char:FindFirstChild("HumanoidRootPart")
         if not hrp then return end
         
         if isMovingToMonster and currentTargetMonster and currentTargetMonster.Parent then
            local targetPart = currentTargetMonster:FindFirstChild("HumanoidRootPart") 
                            or currentTargetMonster.PrimaryPart 
                            or currentTargetMonster:FindFirstChildWhichIsA("BasePart")
            
            if targetPart then
               local targetPos = targetPart.Position - Vector3.new(0, 2, 0)
               local direction = (targetPos - hrp.Position).Unit
               local distance = (targetPos - hrp.Position).Magnitude
               local maxSpeed = math.min(flySpeed, 60)
               local speed = math.min(distance * 2, maxSpeed)
               
               if distance > 5 then
                  bodyVelocity.Velocity = direction * speed
                  bodyGyro.CFrame = CFrame.new(hrp.Position, targetPos)
               else
                  bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                  isMovingToMonster = false
               end
            else
               bodyVelocity.Velocity = Vector3.new(0, 0, 0)
               isMovingToMonster = false
            end
         else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
         end
      end)
   end
   
   local function disableFly()
      if flyConnection then flyConnection:Disconnect(); flyConnection = nil end
      if bodyVelocity then bodyVelocity:Destroy(); bodyVelocity = nil end
      if bodyGyro then bodyGyro:Destroy(); bodyGyro = nil end
   end
   
   local function moveToMonster(monster)
      if not monster then return false end
      
      if monster ~= currentTargetMonster then
         monsterStartTime = tick()
         print("[MONSTER FARM] 🎯 Target:", monster.Name)
      end
      
      currentTargetMonster = monster
      isMovingToMonster = true
      return true
   end
   
   local function activateWeapon()
      if not farmEnabled then return end
      if isBlocking then return end
      
      task.spawn(function()
         pcall(function()
            local args = {"Weapon"}
            ReplicatedStorage:WaitForChild("Shared", 1):WaitForChild("Packages", 1)
               :WaitForChild("Knit", 1):WaitForChild("Services", 1)
               :WaitForChild("ToolService", 1):WaitForChild("RF", 1)
               :WaitForChild("ToolActivated", 1):InvokeServer(unpack(args))
         end)
      end)
   end
   
   local function isMonsterValid(monster)
      if not monster then return false end
      if not monster.Parent then return false end
      
      local currentTime = tick()
      local timeFighting = currentTime - monsterStartTime
      
      if timeFighting > MONSTER_TIMEOUT then
         print("[MONSTER FARM] ⏰ Timeout (6min) - switching monster...")
         return false
      end
      
      if isMonsterClaimedByUs(monster) then return true end
      if isMonsterClaimedByOther(monster) then return false end
      return true
   end
   
   local function checkForNewMobs()
      local currentTime = tick()
      if currentTime - lastMobCheckTime < MOB_CHECK_INTERVAL then return end
      lastMobCheckTime = currentTime
      
      if not currentTargetMonster or not currentTargetMonster.Parent then
         print("[MONSTER FARM] 🔄 Checking for new spawns...")
         local newMonster = findNextMonster(nil)
         if newMonster then
            print("[MONSTER FARM] ✅ Found new spawn:", newMonster.Name)
            moveToMonster(newMonster)
         else
            print("[MONSTER FARM] ⚠️ No monsters found - waiting for respawn...")
         end
      end
   end
   
   local function startFarming()
      if farmConnection then farmConnection:Disconnect() end
      
      local monsterList = table.concat(selectedMonsters, ", ")
      print("[MONSTER FARM] 🎉 Farming:", monsterList)
      
      if farmBlockingEnabled then
         enableFarmBlocking()
         print("[FARM] Mode: Attack + No Dash Block (0.5s)")
      else
         print("[FARM] Mode: Attack ONLY (no blocking)")
      end
      
      enableNoclip()
      task.wait(0.1)
      enableFly()
      
      if Rayfield then
         Rayfield:Notify({
            Title = "Monster Farm", 
            Content = "Farming: " .. (#selectedMonsters > 1 and (#selectedMonsters .. " types") or selectedMonsters[1]), 
            Duration = 3
         })
      end
      
      local spamCount = 0
      local newMonster = findNextMonster(nil)
      if newMonster then moveToMonster(newMonster) end
      
      farmConnection = RunService.Heartbeat:Connect(function()
         if not farmEnabled then return end
         
         checkForNewMobs()
         
         local valid = isMonsterValid(currentTargetMonster)
         if not valid then
            local monster = findNextMonster(currentTargetMonster)
            if monster and monster ~= currentTargetMonster then
               moveToMonster(monster)
            end
         end
         
         if not isBlocking then
            activateWeapon()
         end
         
         spamCount = spamCount + 1
         if spamCount >= 200 then spamCount = 0 end
      end)
   end
   
   local function stopFarming()
      if farmConnection then farmConnection:Disconnect(); farmConnection = nil end
      disableFarmBlocking()
      disableNoclip()
      disableFly()
      currentTargetMonster = nil
      isMovingToMonster = false
      monsterStartTime = 0
      currentMonsterTypeIndex = 1
      print("[MONSTER FARM] ⛔ Stopped")
   end
   
   local function setupRespawnHandler()
      if characterAddedConnection then characterAddedConnection:Disconnect() end
      
      characterAddedConnection = LocalPlayer.CharacterAdded:Connect(function(newCharacter)
         if farmEnabled then
            print("[MONSTER FARM] 🔄 Respawned - restarting...")
            task.wait(1)
            disableFly()
            task.wait(0.5)
            enableNoclip()
            task.wait(0.1)
            enableFly()
            
            currentTargetMonster = nil
            isMovingToMonster = false
            monsterStartTime = 0
            local newMonster = findNextMonster(nil)
            if newMonster then moveToMonster(newMonster) end
         end
      end)
   end
   
   setupRespawnHandler()
   
   MonsterTab:CreateDropdown({
      Name = "Monster Types (Multi-Select)",
      Options = monsterTypes,
      CurrentOption = {"Zombie"},
      MultipleOptions = true,
      Flag = "MonsterFarmTypes",
      Callback = function(Options)
         selectedMonsters = Options
         if #selectedMonsters == 0 then
            selectedMonsters = {"Zombie"}
         end
         currentMonsterTypeIndex = 1
         print("[MONSTER FARM] Selected:", table.concat(selectedMonsters, ", "))
      end,
   })
   
   MonsterTab:CreateSlider({
      Name = "Fly Speed (Max 60)",
      Range = {30, 60},
      Increment = 5,
      Suffix = "Speed",
      CurrentValue = 60,
      Flag = "MonsterFarmFlySpeed",
      Callback = function(Value)
         flySpeed = Value
      end,
   })
   
   MonsterTab:CreateSection("Control")
   
   MonsterTab:CreateToggle({
      Name = "Auto Farm Monsters",
      CurrentValue = false,
      Flag = "AutoMonsterFarm",
      Callback = function(enabled)
         farmEnabled = enabled
         if enabled then
            startFarming()
         else
            stopFarming()
         end
      end,
   })
   
   MonsterTab:CreateToggle({
      Name = "Enable Smart Blocking (Optional)",
      CurrentValue = false,
      Flag = "FarmSmartBlocking",
      Callback = function(enabled)
         farmBlockingEnabled = enabled
         if farmEnabled then
            if enabled then
               enableFarmBlocking()
               print("[FARM] Blocking enabled")
            else
               disableFarmBlocking()
               print("[FARM] Blocking disabled - attack only")
            end
         end
      end,
   })
   
   MonsterTab:CreateParagraph({
      Title = "! WARNING",
      Content = "DO NOT use Auto Block (below)\nwhile Auto Farm is active!\n\nAuto Block is ONLY for manual fighting."
   })
   
   MonsterTab:CreateToggle({
      Name = "Auto Block (Manual Fighting)",
      CurrentValue = false,
      Flag = "AutoMonsterBlock",
      Callback = function(enabled)
         autoBlockEnabled = enabled
         if enabled then
            enableAutoBlock()
         else
            disableAutoBlock()
         end
      end,
   })
   
   print("[MONSTER FARM] ✅ Ready with EXTENSIVE DEBUG MODE!")
   print("[DEBUG] Watch console for detailed No Dash detection logs")
   
   game:GetService("Players").PlayerRemoving:Connect(function(player)
      if player == LocalPlayer then 
         stopFarming()
         if characterAddedConnection then characterAddedConnection:Disconnect() end
      end
   end)
end