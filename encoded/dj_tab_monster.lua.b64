-- dj_tab_monster.lua
-- Auto Monster Farm (like mining but for monsters) + 6min timeout

return function(Window, Rayfield, Utils)
   local MonsterTab = Window:CreateTab("👾 Monster Farm", nil)
   
   MonsterTab:CreateSection("Configuration")
   
   local Players = game:GetService("Players")
   local LocalPlayer = Players.LocalPlayer
   local RunService = game:GetService("RunService")
   local ReplicatedStorage = game:GetService("ReplicatedStorage")
   
   local farmEnabled = false
   local selectedMonster = "Zombie"
   local farmConnection = nil
   local noclipConnection = nil
   local flyConnection = nil
   local blockConnection = nil
   local currentTargetMonster = nil
   local isMovingToMonster = false
   local flySpeed = 80
   local bodyVelocity = nil
   local bodyGyro = nil
   local autoBlockEnabled = false
   local isBlocking = false
   local lastBlockCheck = 0
   local lastAttackTime = 0
   local blockDuration = 0.3
   local characterAddedConnection = nil
   local monsterStartTime = 0
   local MONSTER_TIMEOUT = 360  -- 6 minutes in seconds
   local MAX_BLOCK_DISTANCE = 100
   
   -- Monster Types
   local monsterTypes = {
      "Bomber",
      "Skeleton Rogue",
      "Axe Skeleton",
      "Deathaxe Skeleton",
      "Elite Rogue Skeleton",
      "Elite Deathaxe Skeleton",
      "Zombie",
      "Delver Zombie",
      "Elite Zombie",
      "Brute Zombie",
      "Reaper",
      "Blight Puromancer",
      "Slime",
      "Burning Slime"
   }
   
   print("[MONSTER FARM] Loading...")
   
   -- Get player name from DamageDone value
   local function getPlayerNameFromClaim(claimValue)
      if not claimValue then return nil end
      if claimValue:IsA("Player") then return claimValue.Name end
      if claimValue:IsA("Model") then return claimValue.Name end
      if claimValue.Name then return claimValue.Name end
      return nil
   end
   
   -- Check if monster is claimed by ANOTHER player
   local function isMonsterClaimedByOther(monster)
      if not monster then return false end
      local status = monster:FindFirstChild("Status")
      if not status then return false end
      local damageDone = status:FindFirstChild("DamageDone")
      if not damageDone then return false end
      local claimValue = damageDone.Value
      if not claimValue then return false end
      local claimName = getPlayerNameFromClaim(claimValue)
      if not claimName or claimName == "" then return false end
      return claimName ~= LocalPlayer.Name
   end
   
   -- Check if monster is claimed by US
   local function isMonsterClaimedByUs(monster)
      if not monster then return false end
      local status = monster:FindFirstChild("Status")
      if not status then return false end
      local damageDone = status:FindFirstChild("DamageDone")
      if not damageDone then return false end
      local claimValue = damageDone.Value
      if not claimValue then return false end
      local claimName = getPlayerNameFromClaim(claimValue)
      if not claimName then return false end
      return claimName == LocalPlayer.Name
   end
   
   -- Get distance to monster
   local function getDistanceToMonster(monster)
      if not monster then return math.huge end
      local char = LocalPlayer.Character
      if not char then return math.huge end
      local hrp = char:FindFirstChild("HumanoidRootPart")
      if not hrp then return math.huge end
      local monsterPart = monster:FindFirstChild("HumanoidRootPart") 
                       or monster.PrimaryPart 
                       or monster:FindFirstChildWhichIsA("BasePart")
      if not monsterPart then return math.huge end
      return (hrp.Position - monsterPart.Position).Magnitude
   end
   
   -- Find ALL monsters we are fighting
   local function findAllMyMonsters()
      local living = workspace:FindFirstChild("Living")
      if not living then return {} end
      
      local myMonsters = {}
      for _, entity in pairs(living:GetChildren()) do
         local status = entity:FindFirstChild("Status")
         if status then
            local damageDone = status:FindFirstChild("DamageDone")
            if damageDone and damageDone.Value then
               local claimName = getPlayerNameFromClaim(damageDone.Value)
               if claimName == LocalPlayer.Name then
                  local distance = getDistanceToMonster(entity)
                  if distance <= MAX_BLOCK_DISTANCE then
                     table.insert(myMonsters, entity)
                  end
               end
            end
         end
      end
      return myMonsters
   end
   
   -- Check if monster is attacking
   local function isMonsterAttacking(monster)
      if not monster then return false end
      local status = monster:FindFirstChild("Status")
      if not status then return false end
      local attacking = status:FindFirstChild("Attacking")
      if not attacking then return false end
      local attackValue = attacking.Value
      
      if type(attackValue) == "boolean" then return attackValue == true
      elseif type(attackValue) == "number" then return attackValue > 0
      elseif type(attackValue) == "string" then return attackValue:lower() == "true" or attackValue == "1"
      elseif attackValue ~= nil then return true end
      return false
   end
   
   -- Start blocking
   local function startBlock()
      if isBlocking then return end
      
      task.spawn(function()
         pcall(function()
            local startBlockRemote = ReplicatedStorage:WaitForChild("Shared", 1)
               :WaitForChild("Packages", 1):WaitForChild("Knit", 1)
               :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
               :WaitForChild("RF", 1):WaitForChild("StartBlock", 1)
            startBlockRemote:InvokeServer()
            isBlocking = true
         end)
      end)
   end
   
   -- Stop blocking
   local function stopBlock()
      if not isBlocking then return end
      
      task.spawn(function()
         pcall(function()
            local stopBlockRemote = ReplicatedStorage:WaitForChild("Shared", 1)
               :WaitForChild("Packages", 1):WaitForChild("Knit", 1)
               :WaitForChild("Services", 1):WaitForChild("ToolService", 1)
               :WaitForChild("RF", 1):WaitForChild("StopBlock", 1)
            stopBlockRemote:InvokeServer()
            isBlocking = false
         end)
      end)
   end
   
   -- Auto block system
   local function enableAutoBlock()
      if blockConnection then return end
      
      print("[MONSTER FARM] 🛡️ Auto Block enabled")
      
      blockConnection = RunService.Heartbeat:Connect(function()
         if not autoBlockEnabled then 
            if isBlocking then stopBlock() end
            return 
         end
         
         local currentTime = tick()
         if currentTime - lastBlockCheck < 0.05 then return end
         lastBlockCheck = currentTime
         
         local myMonsters = findAllMyMonsters()
         if #myMonsters == 0 then
            if isBlocking then stopBlock() end
            return
         end
         
         -- Check if ANY monster is attacking
         local anyAttacking = false
         for _, monster in ipairs(myMonsters) do
            if isMonsterAttacking(monster) then
               anyAttacking = true
               break
            end
         end
         
         if anyAttacking then
            lastAttackTime = currentTime
            if not isBlocking then startBlock() end
         else
            local timeSinceAttack = currentTime - lastAttackTime
            if isBlocking and timeSinceAttack > blockDuration then
               stopBlock()
            end
         end
      end)
   end
   
   local function disableAutoBlock()
      if blockConnection then 
         blockConnection:Disconnect()
         blockConnection = nil
      end
      if isBlocking then stopBlock() end
      print("[MONSTER FARM] 🚫 Auto Block disabled")
   end
   
   -- Find next available monster
   local function findNextMonster(monsterType, excludeMonster)
      local living = workspace:FindFirstChild("Living")
      if not living then return nil end
      
      for _, entity in pairs(living:GetChildren()) do
         if entity.Name:find("^" .. monsterType) and entity ~= excludeMonster then
            if not isMonsterClaimedByOther(entity) then
               return entity
            end
         end
      end
      return nil
   end
   
   local function enableNoclip()
      if noclipConnection then return end
      noclipConnection = RunService.Stepped:Connect(function()
         if not farmEnabled then return end
         local character = LocalPlayer.Character
         if character then
            for _, part in pairs(character:GetDescendants()) do
               if part:IsA("BasePart") then part.CanCollide = false end
            end
         end
      end)
   end
   
   local function disableNoclip()
      if noclipConnection then noclipConnection:Disconnect(); noclipConnection = nil end
      local character = LocalPlayer.Character
      if character then
         for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
         end
      end
   end
   
   local function setupFlyBodies()
      local character = LocalPlayer.Character
      if not character then return false end
      local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
      if not humanoidRootPart then return false end
      
      for _, obj in pairs(humanoidRootPart:GetChildren()) do
         if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
      end
      
      bodyVelocity = Instance.new("BodyVelocity")
      bodyVelocity.Velocity = Vector3.new(0, 0, 0)
      bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
      bodyVelocity.Parent = humanoidRootPart
      
      bodyGyro = Instance.new("BodyGyro")
      bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
      bodyGyro.P = 9e4
      bodyGyro.Parent = humanoidRootPart
      return true
   end
   
   local function enableFly()
      if flyConnection then return end
      if not setupFlyBodies() then task.wait(0.5); setupFlyBodies() end
      
      flyConnection = RunService.Heartbeat:Connect(function()
         if not farmEnabled or not bodyVelocity or not bodyGyro then return end
         local char = LocalPlayer.Character
         if not char then return end
         local hrp = char:FindFirstChild("HumanoidRootPart")
         if not hrp then return end
         
         if isMovingToMonster and currentTargetMonster and currentTargetMonster.Parent then
            local targetPart = currentTargetMonster:FindFirstChild("HumanoidRootPart") 
                            or currentTargetMonster.PrimaryPart 
                            or currentTargetMonster:FindFirstChildWhichIsA("BasePart")
            
            if targetPart then
               local targetPos = targetPart.Position - Vector3.new(0, 2, 0)
               local direction = (targetPos - hrp.Position).Unit
               local distance = (targetPos - hrp.Position).Magnitude
               local maxSpeed = math.min(flySpeed, 100)
               local speed = math.min(distance * 2, maxSpeed)
               
               if distance > 5 then
                  bodyVelocity.Velocity = direction * speed
                  bodyGyro.CFrame = CFrame.new(hrp.Position, targetPos)
               else
                  bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                  isMovingToMonster = false
               end
            else
               bodyVelocity.Velocity = Vector3.new(0, 0, 0)
               isMovingToMonster = false
            end
         else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
         end
      end)
   end
   
   local function disableFly()
      if flyConnection then flyConnection:Disconnect(); flyConnection = nil end
      if bodyVelocity then bodyVelocity:Destroy(); bodyVelocity = nil end
      if bodyGyro then bodyGyro:Destroy(); bodyGyro = nil end
   end
   
   local function moveToMonster(monster)
      if not monster then return false end
      
      if monster ~= currentTargetMonster then
         monsterStartTime = tick()
         print("[MONSTER FARM] 🎯 Target:", monster.Name)
      end
      
      currentTargetMonster = monster
      isMovingToMonster = true
      return true
   end
   
   local function activateWeapon()
      if not farmEnabled then return end
      task.spawn(function()
         pcall(function()
            local args = {"Weapon"}
            ReplicatedStorage:WaitForChild("Shared", 1):WaitForChild("Packages", 1)
               :WaitForChild("Knit", 1):WaitForChild("Services", 1)
               :WaitForChild("ToolService", 1):WaitForChild("RF", 1)
               :WaitForChild("ToolActivated", 1):InvokeServer(unpack(args))
         end)
      end)
   end
   
   -- Check if monster is valid with 6-minute timeout
   local function isMonsterValid(monster)
      if not monster then return false end
      if not monster.Parent then return false end
      
      -- 6-minute timeout check
      local currentTime = tick()
      local timeFighting = currentTime - monsterStartTime
      
      if timeFighting > MONSTER_TIMEOUT then
         print("[MONSTER FARM] ⏰ Timeout (6min) - switching monster...")
         return false
      end
      
      if isMonsterClaimedByUs(monster) then return true end
      if isMonsterClaimedByOther(monster) then return false end
      return true
   end
   
   local function startFarming()
      if farmConnection then farmConnection:Disconnect() end
      print("[MONSTER FARM] ⚔️ Farming", selectedMonster)
      
      enableNoclip()
      task.wait(0.1)
      enableFly()
      
      if Rayfield then
         Rayfield:Notify({Title = "Monster Farm", Content = "🎯 " .. selectedMonster, Duration = 3})
      end
      
      local spamCount = 0
      local newMonster = findNextMonster(selectedMonster, nil)
      if newMonster then moveToMonster(newMonster) end
      
      farmConnection = RunService.Heartbeat:Connect(function()
         if not farmEnabled then return end
         
         local valid = isMonsterValid(currentTargetMonster)
         if not valid then
            local monster = findNextMonster(selectedMonster, currentTargetMonster)
            if monster and monster ~= currentTargetMonster then
               moveToMonster(monster)
            end
         end
         
         activateWeapon()
         spamCount = spamCount + 1
         if spamCount >= 200 then spamCount = 0 end
      end)
   end
   
   local function stopFarming()
      if farmConnection then farmConnection:Disconnect(); farmConnection = nil end
      disableNoclip()
      disableFly()
      currentTargetMonster = nil
      isMovingToMonster = false
      monsterStartTime = 0
      print("[MONSTER FARM] ❌ Stopped")
   end
   
   -- Respawn handler
   local function setupRespawnHandler()
      if characterAddedConnection then characterAddedConnection:Disconnect() end
      
      characterAddedConnection = LocalPlayer.CharacterAdded:Connect(function(newCharacter)
         if farmEnabled then
            print("[MONSTER FARM] 🔄 Respawned - restarting...")
            task.wait(1)
            disableFly()
            task.wait(0.5)
            enableNoclip()
            task.wait(0.1)
            enableFly()
            
            currentTargetMonster = nil
            isMovingToMonster = false
            monsterStartTime = 0
            local newMonster = findNextMonster(selectedMonster, nil)
            if newMonster then moveToMonster(newMonster) end
         end
      end)
   end
   
   setupRespawnHandler()
   
   -- UI
   MonsterTab:CreateDropdown({
      Name = "👾 Monster Type",
      Options = monsterTypes,
      CurrentOption = {"Zombie"},
      MultipleOptions = false,
      Flag = "MonsterFarmType",
      Callback = function(Options)
         selectedMonster = Options[1] or "Zombie"
      end,
   })
   
   MonsterTab:CreateSlider({
      Name = "✈️ Fly Speed (Max 100)",
      Range = {30, 100},
      Increment = 5,
      Suffix = "Speed",
      CurrentValue = 80,
      Flag = "MonsterFarmFlySpeed",
      Callback = function(Value)
         flySpeed = Value
      end,
   })
   
   MonsterTab:CreateSection("Control")
   
   MonsterTab:CreateToggle({
      Name = "⚔️ Auto Farm Monsters",
      CurrentValue = false,
      Flag = "AutoMonsterFarm",
      Callback = function(enabled)
         farmEnabled = enabled
         if enabled then
            startFarming()
         else
            stopFarming()
         end
      end,
   })
   
   MonsterTab:CreateToggle({
      Name = "🛡️ Auto Block",
      CurrentValue = false,
      Flag = "AutoMonsterBlock",
      Callback = function(enabled)
         autoBlockEnabled = enabled
         if enabled then
            enableAutoBlock()
         else
            disableAutoBlock()
         end
      end,
   })
   
   MonsterTab:CreateParagraph({
      Title = "✅ Features",
      Content = "14 Monster Types\nAuto fly + noclip\nSmart Auto Block:\n  • Multi-monster support\n  • Distance check (100m)\n  • 6-min timeout system\nAuto-restart after death\n\n💾 Settings auto-saved!"
   })
   
   print("[MONSTER FARM] ✅ Ready!")
   
   game:GetService("Players").PlayerRemoving:Connect(function(player)
      if player == LocalPlayer then 
         stopFarming()
         if characterAddedConnection then characterAddedConnection:Disconnect() end
      end
   end)
end