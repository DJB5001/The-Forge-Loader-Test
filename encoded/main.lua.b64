return function(Window, Rayfield, Utils)
---------------------------------------------------------------------
-- 🏠 HOME TAB
---------------------------------------------------------------------

local MainTab = Window:CreateTab("🏠 Home", nil)
MainTab:CreateSection("Main")

Rayfield:Notify({
   Title = "DJ HUB Loaded 🎉",
   Content = "Welcome to DJ HUB The Forge!\nJoin our Discord: discord.gg/MTXnFfHXW9",
   Duration = 8,
})

---------------------------------------------------------------------
-- ⚡ CONSTANTS
---------------------------------------------------------------------
local DEFAULT_WALKSPEED = 16
local MIN_WALKSPEED = 1
local MAX_WALKSPEED = 500

---------------------------------------------------------------------
-- 🚶 HELPER FUNCTIONS
---------------------------------------------------------------------
local savedWalkSpeed = DEFAULT_WALKSPEED

local function setPlayerWalkSpeed(speed)
   local character = game.Players.LocalPlayer.Character
   if not character then return false end
   
   local humanoid = character:FindFirstChildOfClass("Humanoid")
   if humanoid then
      humanoid.WalkSpeed = speed
      savedWalkSpeed = speed
      return true
   end
   return false
end

game.Players.LocalPlayer.CharacterAdded:Connect(function(character)
   local humanoid = character:WaitForChild("Humanoid", 5)
   if humanoid then
      task.wait(0.1)
      humanoid.WalkSpeed = savedWalkSpeed
   end
end)

---------------------------------------------------------------------
-- ⚡ WALKSPEED CONTROLS
---------------------------------------------------------------------

MainTab:CreateSlider({
   Name = "WalkSpeed Slider",
   Range = {MIN_WALKSPEED, MAX_WALKSPEED},
   Increment = 1,
   Suffix = "Speed",
   CurrentValue = DEFAULT_WALKSPEED,
   Flag = "walkspeed_slider",
   Callback = function(Value)
      if not setPlayerWalkSpeed(Value) then
         Rayfield:Notify({
            Title = "Error",
            Content = "Character not found! Please spawn first.",
            Duration = 3
         })
      end
   end,
})

MainTab:CreateInput({
   Name = "Custom Walkspeed",
   PlaceholderText = "1-500",
   RemoveTextAfterFocusLost = true,
   Flag = "walkspeed_input",
   Callback = function(Text)
      local speed = tonumber(Text)
      
      if not speed then
         Rayfield:Notify({
            Title = "Invalid Input",
            Content = "❌ Please enter a valid number!",
            Duration = 3
         })
         return
      end
      
      speed = math.clamp(speed, MIN_WALKSPEED, MAX_WALKSPEED)
      
      if setPlayerWalkSpeed(speed) then
         Rayfield:Notify({
            Title = "WalkSpeed Updated",
            Content = "✅ Set to " .. speed,
            Duration = 2
         })
      else
         Rayfield:Notify({
            Title = "Error",
            Content = "❌ Character not found!",
            Duration = 3
         })
      end
   end,
})

---------------------------------------------------------------------
-- 🛡️ ANTI-AFK SYSTEM
---------------------------------------------------------------------
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")

local antiAFKConnection = nil

MainTab:CreateToggle({
   Name = "Anti AFK",
   CurrentValue = false,
   Flag = "antiafk_toggle",
   Callback = function(enabled)
      if antiAFKConnection then
         antiAFKConnection:Disconnect()
         antiAFKConnection = nil
      end
      
      if enabled then
         Rayfield:Notify({
            Title = "Anti AFK",
            Content = "✅ Enabled – You won't get kicked for being AFK.",
            Duration = 5
         })
         
         antiAFKConnection = LocalPlayer.Idled:Connect(function()
            VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            task.wait(1)
            VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
         end)
      else
         Rayfield:Notify({
            Title = "Anti AFK",
            Content = "❌ Disabled.",
            Duration = 3
         })
      end
   end,
})

end