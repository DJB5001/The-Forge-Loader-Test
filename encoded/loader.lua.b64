-- DJ HUB — The Forge Script with Key System & Save System
-- Game: The Forge
-- Author: DJB5001
-- Discord: discord.gg/MTXnFfHXW9

local GAME_NAME = "The Forge"
local VERSION = "1.0.0"

-- Multiple game IDs (main game + subplaces)
local ALLOWED_GAME_IDS = {
    76558904092080,
    129009554587176
}

-- ================================================================
-- GAME CHECK (at start)
-- ================================================================
local currentGameId = game.PlaceId
local isAllowed = false

for _, id in ipairs(ALLOWED_GAME_IDS) do
    if currentGameId == id then
        isAllowed = true
        break
    end
end

if not isAllowed then
    local StarterGui = game:GetService("StarterGui")
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "DJ HUB - Wrong Game",
            Text = "This script is for The Forge only!\nYour Game ID: "..tostring(currentGameId),
            Duration = 10
        })
    end)
    error("[DJ HUB] Wrong game! This script is for The Forge only.")
    return
end

print("[DJ HUB] ✅ Game ID verified: The Forge ("..currentGameId..")")

-- ================================================================
-- NO KEY WEEKEND CHECK
-- ================================================================
local function isNoKeyWeekend()
    local now = os.time()
    -- No Key Weekend: Friday Dec 6, 2025 23:00 CET until Monday Dec 9, 2025 00:00 CET
    local startTime = os.time({year=2025, month=12, day=6, hour=22, min=0, sec=0})
    local endTime = os.time({year=2025, month=12, day=8, hour=23, min=0, sec=0})
    return now >= startTime and now <= endTime
end

local NO_KEY_ACTIVE = isNoKeyWeekend()

if NO_KEY_ACTIVE then
    print("[DJ HUB] 🎉 NO KEY WEEKEND ACTIVE! (Until Monday)")
else
    print("[DJ HUB] Key system required")
end

-- ================================================================
-- CONFIG
-- ================================================================
local Config = {
    api = "ef8c4422-f7d4-4b3c-ab4e-c3363317dba9",
    provider = "Keys",
    service = "DJHUB_Test",
    noKeyWeekend = NO_KEY_ACTIVE
}

-- ================================================================
-- SAVE SYSTEM (Filesystem-based)
-- ================================================================
local SaveSystem = {}
local SAVE_DIR = "DJHub/Settings"
local HttpService = game:GetService("HttpService")

local function hasFS()
    return typeof(writefile)=="function" and typeof(readfile)=="function" 
        and typeof(makefolder)=="function" and typeof(isfile)=="function" 
        and typeof(isfolder)=="function" and typeof(delfile)=="function"
end

local function ensureDir()
    if not hasFS() then return false end
    pcall(function()
        if not isfolder("DJHub") then makefolder("DJHub") end
        if not isfolder(SAVE_DIR) then makefolder(SAVE_DIR) end
    end)
    return isfolder(SAVE_DIR)
end

function SaveSystem.save(name)
    if not ensureDir() then return false, "Filesystem not available" end
    local data = {
        version = VERSION,
        saved = os.time(),
        settings = {}
    }
    
    -- Collect all _G settings
    for key, val in pairs(_G) do
        if type(key) == "string" and key:match("^__") then
            local t = type(val)
            if t == "boolean" or t == "number" or t == "string" then
                data.settings[key] = val
            elseif t == "table" then
                local ok, encoded = pcall(function() return HttpService:JSONEncode(val) end)
                if ok then data.settings[key] = encoded end
            end
        end
    end
    
    local ok, json = pcall(function() return HttpService:JSONEncode(data) end)
    if not ok then return false, "Encoding failed" end
    
    local path = ("%s/%s.json"):format(SAVE_DIR, name:gsub("[^%w%-_]", "_"))
    local okw = pcall(function() writefile(path, json) end)
    return okw, okw and nil or "Write failed"
end

function SaveSystem.load(name)
    if not hasFS() then return false, "Filesystem not available" end
    local path = ("%s/%s.json"):format(SAVE_DIR, name:gsub("[^%w%-_]", "_"))
    if not isfile(path) then return false, "File not found" end
    
    local okr, raw = pcall(readfile, path)
    if not okr or type(raw) ~= "string" then return false, "Read failed" end
    
    local ok, data = pcall(function() return HttpService:JSONDecode(raw) end)
    if not ok or type(data) ~= "table" then return false, "Decode failed" end
    
    -- Apply settings
    if data.settings then
        for key, val in pairs(data.settings) do
            if type(val) == "string" and val:match("^[%[{]") then
                local ok2, decoded = pcall(function() return HttpService:JSONDecode(val) end)
                if ok2 then _G[key] = decoded else _G[key] = val end
            else
                _G[key] = val
            end
        end
    end
    
    -- Notify subscribers
    if _G.__DJ_Notify then _G.__DJ_Notify("settings:applied") end
    
    return true
end

function SaveSystem.delete(name)
    if not hasFS() then return false end
    local path = ("%s/%s.json"):format(SAVE_DIR, name:gsub("[^%w%-_]", "_"))
    if isfile(path) then pcall(delfile, path) end
    if _G.__DJ_Notify then _G.__DJ_Notify("saves:changed") end
    return true
end

function SaveSystem.list()
    if not hasFS() or not isfolder(SAVE_DIR) then return {} end
    local files = {}
    local ok = pcall(function()
        for _, file in ipairs(listfiles(SAVE_DIR)) do
            if file:match("%.json$") then
                local name = file:match("([^/\\]+)%.json$")
                local okr, raw = pcall(readfile, file)
                if okr and raw then
                    local ok2, data = pcall(function() return HttpService:JSONDecode(raw) end)
                    if ok2 and data then
                        table.insert(files, {
                            name = name,
                            time = data.saved or 0,
                            version = data.version or "?"
                        })
                    end
                end
            end
        end
    end)
    return files
end

-- Expose globally
_G.saveSettings = SaveSystem.save
_G.loadSettings = SaveSystem.load
_G.deleteSettings = SaveSystem.delete
_G.listSettings = SaveSystem.list

-- Event system
local subscribers = {}
_G.__DJ_Subscribe = function(fn) table.insert(subscribers, fn) end
_G.__DJ_Notify = function(evt) for _, fn in ipairs(subscribers) do pcall(fn, evt) end end

-- ================================================================
-- LOAD COMPONENTS (using _G.DJLoadModule)
-- ================================================================
print("[DJ HUB] Loading The Forge Script...")

local Utils = _G.DJLoadModule("dj_utils")
if not Utils then warn("[DJ HUB] Utils failed to load") end

local Overlay = _G.DJLoadModule("dj_overlay")
if Overlay then
    Overlay.showDiscordProgress(
        "Loading DJ HUB " .. VERSION .. "\nGame: " .. GAME_NAME,
        6
    )
end

local UIBase = _G.DJLoadModule("dj_ui_base")
if not UIBase then error("[DJ HUB] Failed to load UI base") end

local Rayfield, Window = UIBase.createWindow()
if not Rayfield or not Window then error("[DJ HUB] Failed to create window") end

-- Store key tab reference for hiding later
local KeyTabReference = nil

-- ================================================================
-- KEY SYSTEM TAB (or skip if No Key Weekend)
-- ================================================================
local keyVerified = false

local function onKeyVerified()
    keyVerified = true
    task.wait(0.2)
    
    -- Load main tabs with error handling
    print("[DJ HUB] Loading main tabs...")
    
    -- Home Tab
    local buildHome = _G.DJLoadModule("main")
    if buildHome then 
        local ok, err = pcall(buildHome, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Home tab loaded")
        else
            warn("[DJ HUB] ❌ Home tab error:", err)
        end
    end
    
    -- Monster Farm Tab
    local buildMonster = _G.DJLoadModule("dj_tab_monster")
    if buildMonster then 
        local ok, err = pcall(buildMonster, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Monster Farm tab loaded")
        else
            warn("[DJ HUB] ❌ Monster Farm tab error:", tostring(err))
        end
    end
    
    -- Mining Tab
    local buildMining = _G.DJLoadModule("dj_tab_mining")
    if buildMining then 
        local ok, err = pcall(buildMining, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Mining tab loaded")
        else
            warn("[DJ HUB] ❌ Mining tab error:", tostring(err))
        end
    end
    
    -- Extras Tab
    local buildExtras = _G.DJLoadModule("dj_tab_extras")
    if buildExtras then 
        local ok, err = pcall(buildExtras, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Extras tab loaded")
        else
            warn("[DJ HUB] ❌ Extras tab error:", err)
        end
    end
    
    -- Ingame Tab
    local buildIngame = _G.DJLoadModule("dj_tab_ingame")
    if buildIngame then 
        local ok, err = pcall(buildIngame, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Ingame tab loaded")
        else
            warn("[DJ HUB] ❌ Ingame tab error:", err)
        end
    end
    
    -- Misc Tab
    local buildMisc = _G.DJLoadModule("dj_tab_misc")
    if buildMisc then 
        local ok, err = pcall(buildMisc, Window, Rayfield, Utils)
        if ok then
            print("[DJ HUB] ✅ Misc tab loaded")
        else
            warn("[DJ HUB] ❌ Misc tab error:", err)
        end
    end
    
    local welcomeMsg = "The Forge Script ready!"
    if NO_KEY_ACTIVE then
        welcomeMsg = "🎉 NO KEY WEEKEND!\nFree access until Monday!"
    end
    
    Rayfield:Notify({
        Title = "DJ HUB Loaded!",
        Content = welcomeMsg,
        Duration = 6
    })
    
    print("[DJ HUB] The Forge Script loaded successfully!")
end

-- Check if No Key Weekend is active
if NO_KEY_ACTIVE then
    -- Skip key system entirely
    print("[DJ HUB] 🎉 No Key Weekend - Skipping key verification")
    Rayfield:Notify({
        Title = "🎉 NO KEY WEEKEND!",
        Content = "Free access until Monday!\nEnjoy The Forge Script!",
        Duration = 8
    })
    task.delay(1, onKeyVerified)
else
    -- Load key system normally
    local buildKey = _G.DJLoadModule("dj_tab_key")
    if buildKey then
        local ok, result = pcall(buildKey, Window, Rayfield, Utils, Config, onKeyVerified)
        if ok and result then
            KeyTabReference = result
        end
    else
        warn("[DJ HUB] Key tab failed to load")
        onKeyVerified() -- Skip key check if tab fails
    end
end

print("[DJ HUB] The Forge Script loader complete!")